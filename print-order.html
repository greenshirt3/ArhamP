<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Custom Document Printing - Arham Printers</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Online document printing service for A4, Legal, reports, and more." name="description">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <style>
        /* Custom styles for this specific page, matching the overall theme colors */
        :root {
            --bs-primary: #f28b00;
            --bs-secondary: #ff5722; 
            --bs-dark: #212529;
            --mobile-nav-height: 60px;
        }

        /* --- Global Style Consistency --- */
        .page-content-wrapper {
            background-color: #f8fafc;
            min-height: 80vh; 
            padding-bottom: calc(var(--mobile-nav-height) + 40px); /* Ensure padding for sticky nav */
        }
        
        .navbar-brand h1 {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        
        /* --- Page Header Style (Using general page-header class for consistency) --- */
        .page-header {
            /* Default: Use Mobile Image (Placeholder) */
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url(img/banners/printbanner-mobile.webp) center center no-repeat;
            background-size: cover;
            min-height: 200px;
        }
        @media (min-width: 768px) {
            .page-header {
                /* Override: Use Desktop Image (Placeholder) */
                background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url(img/banners/printbanner-desktop.webp) center center no-repeat;
                background-size: cover;
                min-height: 300px;
            }
        }
        
        /* --- Form Styling (Adopted from other files, adjusted) --- */
        .option-group {
            border: 1px solid #dee2e6;
            padding: 1rem;
            border-radius: 0; /* Plane corners */
            margin-bottom: 1.5rem;
            background-color: #ffffff;
        }

        .option-group h4 {
            border-bottom: 2px solid var(--bs-primary);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            color: var(--bs-dark);
            font-weight: 600;
        }

        .option-label {
            font-weight: 700;
            color: var(--bs-dark);
            margin-bottom: 0.5rem;
            display: block;
        }

        .choice-card-label {
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 0; /* Plane corners */
            padding: 8px 15px;
            transition: all 0.2s ease;
            font-weight: 500;
            display: inline-block;
        }
        .choice-card-label:hover {
            border-color: var(--bs-secondary);
            background-color: #fff8f8;
        }
        input[type="radio"]:checked + .choice-card-label {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary);
            color: white;
        }
        
        /* Price Summary */
        .price-summary-box {
            background-color: var(--bs-dark); 
            color: white;
            padding: 1rem;
            border-radius: 0;
            text-align: right;
            display: flex; 
            flex-direction: column;
            justify-content: center; 
        }
        
        .price-summary-box #totalPrice {
            color: var(--bs-primary); 
            display: block;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .whatsapp-action-block {
            background-color: #f7f7f7; 
            border: 1px solid #eee;
            padding: 1.5rem;
            border-radius: 0;
            margin-top: 1.5rem;
        }
        
        .whatsapp-action-block .row {
            align-items: center; 
        }
        
        .whatsapp-action-block .col-md-6 {
            display: flex;
        }
        
        /* --- MOBILE NAV STYLES (Copied for consistency) --- */
        #mobile-bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: var(--mobile-nav-height);
            background: white; border-top: 1px solid #ddd; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1030; display: flex; align-items: center; justify-content: space-around;
        }
        #mobile-bottom-nav > a, #mobile-bottom-nav > div { flex: 1 1 0%; }
        .mobile-nav-link {
            display: flex; flex-direction: column; align-items: center; text-align: center;
            text-decoration: none; color: var(--bs-dark); font-size: 0.6rem; padding: 5px 0;
            transition: color 0.2s; position: relative; height: 100%; justify-content: center;
        }
        .mobile-nav-link:hover { color: var(--bs-primary); }
        .mobile-nav-link i { font-size: 1.1rem; margin-bottom: 2px; line-height: 1; }
        .mobile-nav-link.active { color: var(--bs-primary); }
        #mobile-nav-logo { display: flex; justify-content: center; align-items: center; position: relative; }
        #mobile-nav-logo a {
            background-color: var(--bs-primary); color: white; width: 45px; height: 45px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 10px rgba(242, 139, 0, 0.6); position: absolute; top: -15px; 
            left: 50%; transform: translateX(-50%); 
        }
        
        @media (max-width: 991.98px) {
            /* Adjust content padding for bottom nav */
            .page-content-wrapper {
                padding-bottom: calc(var(--mobile-nav-height) + 15px) !important; 
            }
            .terms-content {
                margin-bottom: calc(var(--mobile-nav-height) + 15px);
            }
        }
        
        /* Mobile Dropdown Specific Styling */
        #mobile-bottom-nav .dropdown-menu {
            position: absolute; bottom: var(--mobile-nav-height); left: 50%; 
            transform: translateX(-50%); width: 250px; box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            border-radius: 8px 8px 0 0; padding: 10px 0;
        }
        
    </style>
</head>

<body>
    <div class="container">
    <div id="spinner"
        class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    
    <div class="container-fluid bg-dark text-white-50 py-2 px-0 d-none d-lg-block">
        <div class="row gx-0 align-items-center">
            <div class="col-lg-7 px-5 text-start">
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="fa fa-phone-alt me-2"></small>
                    <small>+92 300 6238233</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-envelope-open me-2"></small>
                    <small>info@arhamprinters.pk</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-clock me-2"></small>
                    <small>Mon - Fri : 09 AM - 09 PM</small>
                </div>
            </div>
            <div class="col-lg-5 px-5 text-end">
                <div class="h-100 d-inline-flex align-items-center">
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-twitter"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top px-4 px-lg-5 d-none d-lg-block">
        <a href="index.html" class="navbar-brand d-flex align-items-center">
             <img src="img/logo2.webp" alt="Arham Printers Logo" style="height: 40px; margin-right: 1rem;">
        </a>
        <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav mx-auto bg-light pe-4 py-3 py-lg-0">
                <a href="index.html" class="nav-item nav-link">Home</a>
                <a href="#" class="nav-item nav-link" onclick="showSection('products')">Products</a>
                <a href="#" class="nav-item nav-link" onclick="showSection('wedding')">Wedding Cards</a>
                <a href="#" class="nav-item nav-link active">Print Order</a>
                <a href="#" class="nav-item nav-link" onclick="showSection('contact')">Contact</a>
            </div>
             <div class="h-100 d-lg-inline-flex align-items-center">
                <a href="#" class="btn btn-primary py-2 px-3 rounded-0 d-none d-lg-block" onclick="showSection('quote')">Get a Quote<i
                        class="fa fa-arrow-right ms-3"></i></a>
            </div>
        </div>
    </nav>

     <nav id="mobile-bottom-nav" class="d-lg-none">
        <a href="index.html" class="mobile-nav-link" id="mobile-link-home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="products.html" class="mobile-nav-link" id="mobile-link-products">
            <i class="fas fa-th-list"></i>
            <span>Products</span>
        </a>
        <a href="wedding.html" class="mobile-nav-link" id="mobile-link-wedding">
            <i class="fas fa-gift"></i>
            <span>Wedding Cards</span>
        </a> 
        <a href="print-order.html" class="mobile-nav-link active" id="mobile-link-print">
            <i class="fas fa-print"></i>
            <span>Custom Prints</span>
        </a> 
        <a href="#cart-section" class="mobile-nav-link" onclick="showSection('cart')" id="mobile-link-cart">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count" class="position-absolute translate-middle badge rounded-pill bg-primary" style="top: 8px; right: 10px; font-size: 0.7em;">0</span>
            <span>Cart</span>
        </a>
    </nav>
    
    <div class="container page-content-wrapper py-5">
        <div class="page-header mb-5">
             <h2 class="text-center text-white display-6 py-5">Custom Document Printing</h2>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="bg-white p-4 p-md-5 rounded-0 shadow-lg"> <h3 class="fw-bold mb-4 text-center">Configure Your Print Order</h3>
                    
                    <form id="printOrderForm" method="POST" enctype="multipart/form-data" class="row g-4" onsubmit="handlePrintOrderSubmission(event)">
                        
                        <div class="col-12">
                            <div class="option-group">
                                <h4>1. Print Specifications</h4>
                                
                                <div class="row g-4">
                                    
                                    <div class="col-md-6">
                                        <label class="option-label">Print Colour</label>
                                        <div class="d-flex choice-card-group">
                                            <input type="radio" name="color" id="color-bw" value="Black & White" checked>
                                            <label class="choice-card-label" for="color-bw">Black & White</label>
                                            
                                            <input type="radio" name="color" id="color-full" value="Colour">
                                            <label class="choice-card-label" for="color-full">Colour</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="option-label">Print Siding</label>
                                        <div class="d-flex choice-card-group">
                                            <input type="radio" name="siding" id="siding-single" value="Single Sided" checked>
                                            <label class="choice-card-label" for="siding-single">Single Sided</label>
                                            
                                            <input type="radio" name="siding" id="siding-double" value="Double Sided">
                                            <label class="choice-card-label" for="siding-double">Double Sided</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="option-label">Paper Size</label>
                                        <div class="d-flex choice-card-group">
                                            <input type="radio" name="size" id="size-a4" value="A4" checked>
                                            <label class="choice-card-label" for="size-a4">A4</label>
                                            
                                            <input type="radio" name="size" id="size-legal" value="Legal">
                                            <label class="choice-card-label" for="size-legal">Legal</label>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label class="option-label">Paper GSM</label>
                                        <div class="d-flex choice-card-group">
                                            <input type="radio" name="paperGsm" id="gsm-70" value="70g" checked>
                                            <label class="choice-card-label" for="gsm-70">70g</label>
                                            
                                            <input type="radio" name="paperGsm" id="gsm-80" value="80g">
                                            <label class="choice-card-label" for="gsm-80">80g</label>

                                            <input type="radio" name="paperGsm" id="gsm-100" value="100g">
                                            <label class="choice-card-label" for="gsm-100">100g</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <label for="quantity" class="option-label">Number of Sheets (Quantity)</label>
                                    <div class="quantity-group">
                                        <input type="number" id="quantity" name="quantity" value="1" min="1" required class="form-control w-100">
                                    </div>
                                    <small class="text-muted">Enter the number of physical sheets to be printed.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                             <div class="option-group">
                                <h4>2. Upload Document File</h4>
                                <label for="documentFile" class="option-label">Select File (PDF, DOCX, JPG recommended)</label>
                                <input type="file" id="documentFile" name="documentFile" required class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                                <small class="text-danger mt-2 d-block">
                                    *Required for printing. File will be uploaded to our server for processing.*
                                </small>
                            </div>
                        </div>

                        <input type="hidden" name="orderId" id="orderId">
                        
                        <div class="col-12 mt-4">
                            <div class="option-group">
                                <h4>3. Delivery Location</h4>
                                <label><i class="fas fa-map-marker-alt me-2"></i> <strong>Check Delivery Charges:</strong></label>
                                
                                <div class="d-flex gap-2 mb-2">
                                    <button type="button" class="btn btn-outline-primary w-50 rounded-0" onclick="detectLocation()">
                                        <i class="fas fa-search-location me-2"></i> Auto-Detect City
                                    </button>
                                    <input type="text" id="input-city" placeholder="Or Enter Your City Name" class="form-control rounded-0 w-50" oninput="manualLocationCheck()">
                                </div>
                                
                                <small class="text-muted d-block mb-2" id="current-location-display">
                                    Current Zone: <span id="zone-name" class="fw-bold text-dark">Not Set (Jalalpur Jattan Default)</span>
                                </small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="whatsapp-action-block">
                                <h4 class="text-primary fw-bold text-center">Finalize Order</h4>
                                   <div class="row g-3 align-items-center justify-content-center">
                                        <div class="col-md-6">
                                            <div class="price-summary-box">
                                                Order Subtotal:
                                                <span id="totalPrice"><span class="fw-bold">0.00</span></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="price-summary-box bg-success p-2">
                                                Delivery Cost:
                                                <span id="shipping-cost-display" class="fw-bold" style="color: white; font-size: 1.2em;">PKR 0</span>
                                                <p class="small text-white-75 mb-0" id="shipping-note-display" style="font-weight: normal; font-size: 0.7em;">
                                                    Jalalpur Jattan (Default)
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary py-3 w-100 fw-bold rounded-0" id="submitButton">
                                                <i class="fas fa-envelope me-2"></i> Place Order & Upload
                                            </button>
                                        </div>
                                    </div>
                            </div>
                        </div>
                        
                        <div class="col-12 text-center mt-3">
                            <p class="small text-muted">
                                By placing an order, you confirm you have read and agree to our <a href="#terms-section" class="text-primary fw-bold">Print Service Terms & Conditions</a>.
                            </p>
                        </div>
                    </form>

                    <div id="terms-section" class="terms-content">
                        <h4>ðŸ“„ Print Service Terms and Conditions</h4>
                        
                        <h5 class="fw-bold">1. File Submission & Quality</h5>
                        <ul class="list-unstyled text-muted ps-3">
                            <li><i class="fas fa-check-circle text-success me-2"></i>**File Format:** We strongly recommend submitting files in **PDF format** for the highest compatibility and print quality. We also accept JPG, PNG, DOCX, and PPTX.</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>**Preparation:** All documents must be **unzipped and free of password protection**. The customer is responsible for ensuring the file is correctly sized (e.g., an A4 file for A4 prints).</li>
                            <li><i class="fas fa-times-circle text-danger me-2"></i>**Borderless Printing:** We are unable to offer borderless (full bleed) printing via this standard online service. A small white margin will be applied to all prints.</li>
                        </ul>

                        <h5 class="fw-bold">2. Content & Order Restriction</h5>
                        <ul class="list-unstyled text-muted ps-3">
                            <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>**Inappropriate Content:** We reserve the right to decline any order that, in our sole judgment, contains offensive, inflammatory, discriminatory, illegal, or otherwise inappropriate content.</li>
                        </ul>

                        <h5 class="fw-bold">3. Payment & Refunds</h5>
                        <ul class="list-unstyled text-muted ps-3">
                            <li><i class="fas fa-dollar-sign text-primary me-2"></i>**Non-Refundable:** All print orders are considered **non-refundable** once the printing process has commenced.</li>
                            <li><i class="fas fa-shield-alt text-success me-2"></i>**Quality Guarantee:** If you encounter any issues with the print quality due to our error, we are happy to provide a **free reprint** if the issue is reported within **24 hours** of collection or delivery.</li>
                            <li><i class="fas fa-truck text-primary me-2"></i>**Delivery Charges:** The final price confirmed via WhatsApp will include delivery charges, which will be determined based on the customer's delivery address.</li>
                        </ul>

                        <h5 class="fw-bold">4. Data Security (GDPR Compliance)</h5>
                        <ul class="list-unstyled text-muted ps-3">
                            <li><i class="fas fa-lock text-primary me-2"></i>**Digital File Retention:** To protect your privacy, all digital files uploaded to our OneDrive folder will be automatically deleted from our server/cloud storage after **7 days** from order completion.</li>
                            <li><i class="fas fa-shredder text-secondary me-2"></i>**Uncollected Prints:** Physical documents that are uncollected will be securely shredded in accordance with GDPR after **30 days** of the order date. No refund will be issued for uncollected prints.</li>
                        </ul>
                    </div>
                    </div>
            </div>
        </div>
    </div>

<div class="container-fluid footer py-2">
      <div class="container py-2">
        <div class="row g-3">
          <div class="col-6 col-md-3">
            <div class="rounded p-2 d-flex flex-column align-items-center">
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto" style="width: 56px; height: 56px;">
                <i class="fas fa-map-marker-alt fa-2x text-primary" style="line-height: 1);"></i>
              </div>
              <h6 class="text-white mt-1 mb-1">Address</h6>
              <p class="text-white fw-bold mb-1 small text-center">Domela Chowk, Tanda Road, Jalalpur Jattan</p>
            </div>
          </div>

          <div class="col-6 col-md-3">
            <div class="rounded p-2 d-flex flex-column align-items-center">
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto" style="width: 56px; height: 56px;">
                <i class="fas fa-envelope fa-2x text-primary" style="line-height: 1);"></i>
              </div>
              <h6 class="text-white mt-1 mb-1">Mail Us</h6>
              <p class="text-white fw-bold mb-1 small text-center">info@arhamprinters.pk</p>
            </div>
          </div>

          <div class="col-6 col-md-3">
            <div class="rounded p-2 d-flex flex-column align-items-center">
              <a href="https://wa.me/923006238233" target="_blank" class="text-decoration-none">
                <div class="rounded-circle bg-success d-flex align-items-center justify-content-center mb-2 mx-auto" style="width: 56px; height: 56px;">
                  <i class="fab fa-whatsapp fa-2x text-white" style="line-height: 1);"></i>
                </div>
              </a>
              <h6 class="text-white mt-1 mb-1">Direct Contact</h6>
              <a href="https://wa.me/923006238233" target="_blank" class="text-white-50 text-decoration-none">
                <p class="text-white fw-bold mb-1 small text-center">+92 300 6238233</p>
              </p>
            </div>
          </div>

          <div class="col-6 col-md-3">
            <div class="rounded p-2 d-flex flex-column align-items-center">
              <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto" style="width: 56px; height: 56px;">
                <i class="fab fa-facebook-f fa-2x text-primary" style="line-height: 1);"></i>
              </div>
              <h6 class="text-white mt-1 mb-1">Follow Us</h6>
              <div class="d-flex justify-content-center gap-1">
                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i class="fab fa-twitter"></i></a>
                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i class="fab fa-youtube"></i></a>
                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i class="fab fa-linkedin-in"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container-fluid copyright py-2">
        <div class="container">
          <div class="row">
            <div class="col-12 text-center">
              <span class="text-white small">
                <i class="fas fa-copyright text-light me-1"></i>
                Arham Printers, All rights reserved 2025.
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    
    <script src="js/main.js"></script>

    <script>
    function showSection(sectionName) {
        // Handle external navigation for pages not hosted here
        if (sectionName === 'home') {
             window.location.href = 'index.html';
        } else if (sectionName === 'contact') {
             window.location.href = 'index.html#contact-section';
        } else if (sectionName === 'quote') {
             window.location.href = 'index.html#quote-section';
        } else if (sectionName === 'products' || sectionName === 'shop-catalog') {
             window.location.href = 'products.html';
        } else if (sectionName === 'wedding') {
             window.location.href = 'wedding.html';
        } else if (sectionName === 'cart') {
             // Redirects to products.html which should contain the cart section
             window.location.href = 'products.html#cart-section';
        } 
        window.scrollTo(0, 0);

        if (typeof setActiveMobileNav === 'function') {
            setActiveMobileNav(sectionName);
        }
    }
    </script>
    <script>
        const SUBMIT_ORDER_URL = 'upload_and_notify.php';
        const WHATSAPP_NUMBER = '923006238233';
        
        let pricingData = null;
        const PRICING_DATA_URL = 'all_prices.json';

        // îžå°… REPLACE THIS WITH YOUR ACTUAL GOOGLE MAPS API KEY îžå°…
        const GOOGLE_MAPS_API_KEY = 'AIzaSyCAz3R9s0BdNnwgEtaC31LJcIqlkoXh05U'; 
        let currentShippingZone = 'Within City'; // Default to cheapest zone (JLP)

        // --- SHIPPING RATE CONFIGURATION (SMALL PACKET) ---
        const SHIPPING_RATES = {
            'small': { 'Within City': 100, 'Same Province': 347, 'Cross Province': 359 },
        };

        const LOCAL_FREE_SHIPPING_THRESHOLD = 2500; // PKR 2,500
        const LOCAL_SHIPPING_RATES = { 
            'small': 100, 
        };

        const CITY_TO_ZONE = {
            "jalalpur jattan": "Within City", "gujrat": "Same Province", "gujranwala": "Same Province", 
            "lahore": "Same Province", "sialkot": "Same Province", "karachi": "Cross Province",
        };
        
        // --- Core Shipping Functions ---
        
        function getShippingPacketType(productName="Digital Print") {
            // Documents are typically small packet
            return 'small'; 
        }

        function getPostExShippingCost(packetType, zone) {
            const rates = SHIPPING_RATES[packetType];
            if (rates && rates[zone]) return rates[zone];
            return SHIPPING_RATES['small']['Cross Province']; // Fallback
        }
        
        function calculateShippingData(basePrice) {
            const packetType = getShippingPacketType();
            let shippingCost = getPostExShippingCost(packetType, currentShippingZone);
            let finalShippingNote = '';

            // --- LOCAL DELIVERY LOGIC ---
            if (currentShippingZone === 'Within City') {
                if (basePrice >= LOCAL_FREE_SHIPPING_THRESHOLD) {
                    shippingCost = 0;
                    finalShippingNote = `FREE Delivery! (Local JLP orders over PKR ${LOCAL_FREE_SHIPPING_THRESHOLD.toLocaleString('en-PK')})`;
                } else {
                    shippingCost = LOCAL_SHIPPING_RATES[packetType] || 0;
                    finalShippingNote = `Local Flat Rate (Self-Delivery).`;
                }
            } else {
                // Cross-Province/Same-Province uses PostEx Courier
                finalShippingNote = `PostEx Courier (to ${currentShippingZone}). Includes courier fee, fuel surcharge, and GST.`;
            }

            return { cost: shippingCost, note: finalShippingNote, basePrice: basePrice + shippingCost };
        }

        // --- LOCATION DETECTION LOGIC ---

        function manualLocationCheck() {
            const cityInput = document.getElementById('input-city').value.trim();
            if (cityInput.length < 3) return;
            updateShippingZone(cityInput);
        }

        function detectLocation() {
            if (GOOGLE_MAPS_API_KEY === 'YOUR_API_KEY_HERE') {
                showAlert("API Key not configured. Cannot auto-detect location.", 'error');
                return;
            }
            document.getElementById('zone-name').textContent = "Detecting...";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                showAlert("Geolocation is not supported by this browser.", 'error');
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const geocoder = new google.maps.Geocoder();
            const latlng = { lat: parseFloat(lat), lng: parseFloat(lng) };

            geocoder.geocode({ location: latlng }, (results, status) => {
                if (status === "OK" && results[0]) {
                    const addressComponents = results[0].address_components;
                    let detectedCity = "";
                    addressComponents.forEach(component => {
                        if (component.types.includes("locality")) {
                            detectedCity = component.long_name;
                        }
                    });
                    
                    if (detectedCity) {
                         document.getElementById('input-city').value = detectedCity;
                         updateShippingZone(detectedCity);
                    } else {
                         document.getElementById('zone-name').textContent = "City not found. Defaulting to JLP.";
                    }
                } else {
                    showAlert(`Geolocation failed: ${status}`, 'error');
                    document.getElementById('zone-name').textContent = "Detection Failed. Defaulting to JLP.";
                }
            });
        }

        function showError(error) {
            showAlert("Error detecting location: " + error.message, 'error');
            document.getElementById('zone-name').textContent = "Detection Failed. Defaulting to JLP.";
        }

        function updateShippingZone(cityName) {
            const normalizedCity = cityName.toLowerCase().replace(/[^a-z0-9]/g, ' ').trim();
            let zone = 'Cross Province'; 
            
            if (CITY_TO_ZONE[normalizedCity]) {
                zone = CITY_TO_ZONE[normalizedCity];
            } else {
                if (cityName.toLowerCase().includes('lahore') || cityName.toLowerCase().includes('gujrat')) {
                     zone = 'Same Province';
                }
            }
            
            currentShippingZone = zone;
            
            const zoneDisplay = document.getElementById('zone-name');
            zoneDisplay.textContent = `${currentShippingZone} (${cityName})`;
            zoneDisplay.classList.remove('text-success', 'text-warning', 'text-danger');
            zoneDisplay.classList.add(zone === 'Within City' ? 'text-success' : (zone === 'Same Province' ? 'text-warning' : 'text-danger'));
            
            // Re-calculate price with new zone, but only update shipping display
            calculateEstimatedPrice(true); 
        }

        // --- REAL-TIME CALCULATE PRICE FUNCTION ---

        // Fetch pricing data from JSON file
        async function fetchPricingData() {
            try {
                const response = await fetch(PRICING_DATA_URL); 
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const rawData = await response.json();
                
                pricingData = rawData['B/W and Color Prints']; 
                
                if (!pricingData) {
                    throw new Error('Digital Print Pricing structure not found in JSON.');
                }
                
                calculateEstimatedPrice(true); 
            } catch (error) {
                console.error('Could not fetch pricing data:', error);
                document.getElementById('totalPrice').innerHTML = '<span>Error loading prices!</span>';
            }
        }

        /**
         * Determines the price per unit based on the total pages and defined tiers.
         */
        function getTierPrice(gsmPricing, totalPages) {
            let highestTierPrice = 0;
            
            const tiers = Object.keys(gsmPricing).sort((a, b) => {
                const minA = parseInt(a.split('-')[0]);
                const minB = parseInt(b.split('-')[0]);
                return minA - minB;
            });
            
            if (tiers.length > 0) {
                // Get price from the largest range as a fallback/cap
                highestTierPrice = gsmPricing[tiers[tiers.length - 1]];
            }

            for (const range of tiers) {
                const [min, max] = range.split('-').map(n => parseInt(n));
                
                if (totalPages >= min && (isNaN(max) || totalPages <= max)) {
                    return gsmPricing[range];
                }
            }
            
            // If totalPages exceeds all explicit ranges, use the highest tier's price
            if (tiers.length > 0) {
                 return highestTierPrice;
            }

            return 0;
        }

        function calculateEstimatedPrice(updateShipping=false) {
            if (!pricingData) {
                document.getElementById('totalPrice').innerHTML = '<span>Loading Prices...</span>';
                return;
            }

            const size = document.querySelector('input[name="size"]:checked')?.value;
            const paperGsm = document.querySelector('input[name="paperGsm"]:checked')?.value; 
            const color = document.querySelector('input[name="color"]:checked')?.value;
            const siding = document.querySelector('input[name="siding"]:checked')?.value;
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!size || !paperGsm || !color || !siding || quantity <= 0 || isNaN(quantity)) {
                document.getElementById('totalPrice').innerHTML = '<span class="fw-bold">0.00</span>';
                document.getElementById('shipping-cost-display').textContent = 'PKR 0';
                document.getElementById('shipping-note-display').textContent = 'Enter quantity & specs.';
                return;
            }

            const sizeKey = size;
            const colorKey = color === 'Black & White' ? 'black_white' : 'color';
            const gsmKey = paperGsm;
            const totalSheets = quantity;
            const totalPages = totalSheets * (siding === 'Double Sided' ? 2 : 1); 

            let subtotalPrice = 0;
            let pricePerUnit = 0;

           try {
                const gsmPricing = pricingData?.[sizeKey]?.[colorKey]?.[gsmKey];
                if (!gsmPricing) throw new Error('Pricing Config Error!');

                pricePerUnit = getTierPrice(gsmPricing, totalPages);
                if (pricePerUnit === 0) throw new Error('Pricing Error!');
                
                subtotalPrice = pricePerUnit * totalPages;
                
            } catch (e) {
                console.error("Error in price calculation lookup:", e);
                document.getElementById('totalPrice').innerHTML = '<span>Configuration Error!</span>';
                return;
            }
            
            // --- SHIPPING CALCULATION ---
            const shippingData = calculateShippingData(subtotalPrice);
            const shippingCost = shippingData.cost;
            const totalPrice = subtotalPrice + shippingCost;
            
            // --- FINAL PRICE DISPLAY ---
            const priceOutput = `<span class="fw-bold">${Math.round(totalPrice).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                 <p class="small text-white-75 mb-0 mt-1" style="font-weight: normal; font-size: 0.8em;">
                     (Total Pages: ${totalPages} @ PKR ${pricePerUnit.toFixed(2)}/page)
                 </p>`;

            document.getElementById('totalPrice').innerHTML = priceOutput;
            
            // --- SHIPPING DISPLAY ---
            document.getElementById('shipping-cost-display').textContent = shippingCost === 0 ? "FREE" : `PKR ${shippingCost.toLocaleString('en-PK', { minimumFractionDigits: 0 })}`;
            document.getElementById('shipping-note-display').textContent = shippingData.note;

        }

        // --- ORDER SUBMISSION FUNCTION (MODIFIED) ---
        async function handlePrintOrderSubmission(e) {
            e.preventDefault();
            
            calculateEstimatedPrice(); 

            const submitButton = document.getElementById('submitButton');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Submitting...';
            
            const totalPrintingPriceElement = document.getElementById('totalPrice').querySelector('span');
            const totalPrintingPrice = totalPrintingPriceElement ? totalPrintingPriceElement.textContent : '0.00';
            const shippingCostDisplay = document.getElementById('shipping-cost-display').textContent;
            
            if (totalPrintingPrice === '0.00' || totalPrintingPrice.includes('Error') || totalPrintingPrice.includes('Configuration')) {
                showAlert('Cannot submit order: Price is invalid. Please ensure all options are selected.', 'error');
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-envelope me-2"></i> Place Order & Upload';
                return;
            }
            
            const fileInput = document.getElementById('documentFile');
            if (!fileInput.files.length) {
                 showAlert('Please select a document file to upload.', 'error');
                 submitButton.disabled = false;
                 submitButton.innerHTML = '<i class="fas fa-envelope me-2"></i> Place Order & Upload';
                 return;
            }

            const orderId = 'PRINT-' + Date.now().toString().slice(-6);
            
            const formData = new FormData(document.getElementById('printOrderForm'));
            formData.append('order_type', 'DOCUMENT_PRINTING');
            formData.append('order_id', orderId);
            formData.append('total_price_display', totalPrintingPrice);
            
            const specs = {
                color: document.querySelector('input[name="color"]:checked')?.value,
                siding: document.querySelector('input[name="siding"]:checked')?.value,
                size: document.querySelector('input[name="size"]:checked')?.value,
                gsm: document.querySelector('input[name="paperGsm"]:checked')?.value,
                sheets: document.getElementById('quantity').value,
                pages: parseInt(document.getElementById('quantity').value) * (document.querySelector('input[name="siding"]:checked')?.value === 'Double Sided' ? 2 : 1),
                shipping_zone: currentShippingZone,
                shipping_cost: shippingCostDisplay
            };
            
            formData.append('specs_json', JSON.stringify(specs));
            
            // Send detailed confirmation to WhatsApp (New Step)
            let whatsappMessage = `*NEW DOCUMENT PRINT ORDER (WEB)*\n`;
            whatsappMessage += `*Order ID:* ${orderId}\n`;
            whatsappMessage += `*File:* ${fileInput.files[0].name}\n`;
            whatsappMessage += `*Delivery To:* ${currentShippingZone} (${document.getElementById('input-city')?.value || 'Not Entered'})\n`;
            whatsappMessage += `*Total Price:* ${totalPrintingPrice}\n`;
            whatsappMessage += `*Delivery Cost:* ${shippingCostDisplay}\n`;
            whatsappMessage += `\n*Printing Specs:*\n`;
            whatsappMessage += `  - Pages/Sheets: ${specs.pages} (${specs.sheets} sheets)\n`;
            whatsappMessage += `  - Color: ${specs.color}\n`;
            whatsappMessage += `  - Siding: ${specs.siding}\n`;
            whatsappMessage += `  - Size/GSM: ${specs.size} / ${specs.gsm}\n`;
            whatsappMessage += `\n*NOTE:* Please quote the order ID with your full name and address for final confirmation.`;
            
            
            showAlert('Uploading file and sending order details...', 'info');

            try {
                // NOTE: This server call assumes your upload_and_notify.php handles file saving and sending an internal notification (like email).
                const response = await fetch(SUBMIT_ORDER_URL, {
                    method: 'POST',
                    body: formData 
                });
                
                // Immediately open WhatsApp for the user to confirm details and finish the order process.
                window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');


                if (response.ok) {
                    showAlert(`Order ${orderId} submitted! WhatsApp opened to confirm delivery details.`, 'success');
                    document.getElementById('printOrderForm').reset();
                    // Reset to default location and price
                    updateShippingZone('Jalalpur Jattan');
                } else {
                    showAlert('Server error during file upload. Please confirm details on WhatsApp.', 'error');
                }
            } catch (error) {
                console.error('Submission failed:', error);
                showAlert('Network error. Please confirm your order details on WhatsApp.', 'error');
                // Ensure WhatsApp is opened even if the network upload fails
                window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-envelope me-2"></i> Place Order & Upload';
            }
        }

        // --- UI HELPERS ---
        
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.style.minWidth = '300px';
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 5000);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Inject Google Maps API script
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
            document.head.appendChild(script);
            
            document.querySelectorAll('input[name="color"], input[name="siding"], input[name="size"], input[name="paperGsm"]').forEach(input => {
                input.addEventListener('change', calculateEstimatedPrice);
            });
            document.getElementById('quantity').addEventListener('input', calculateEstimatedPrice);
            
            document.getElementById('printOrderForm').addEventListener('submit', handlePrintOrderSubmission);

            document.getElementById('spinner').classList.remove('show');

            if (typeof setActiveMobileNav === 'function') {
                setActiveMobileNav('products');
            }
            await fetchPricingData();
            updateShippingZone('Jalalpur Jattan'); // Set default zone on load
        });
    </script>
</body>
</html>
