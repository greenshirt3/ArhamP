<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .product-card { 
            background-color: white; 
            border: 1px solid #ddd; 
            margin-bottom: 20px; 
            padding: 15px; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-title { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 10px; }
        .product-options { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .product-options div { font-weight: bold; width: 100%; margin-top: 10px; }
        .variation-tag { 
            display: inline-block; 
            padding: 5px 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: background-color 0.3s;
            margin-right: 5px;
        }
        .variation-tag.selected { background-color: #007bff; color: white; border-color: #007bff; }
        .price-display { font-size: 1.2em; font-weight: bold; color: #28a745; }
        .category-title { color: #007bff; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    </style>
</head>
<body>

    <h1>Standardized Product Catalog</h1>
    <p>Click on a product variation to see the filtering in action.</p>

    <div id="catalog-container">
        </div>

    <script>
        // NOTE: In a real environment, you would use fetch('items.json') to load this data.
        // For this demo, the final JSON is embedded here as a string for immediate execution.
        const productData = {
            "Business Essentials": {
                "Shine Visisting Cards": {
                    "All Options": [
                        { "Size": "3.5x2", "Quality": "Standard", "Finish": "Shine", "Sides": "Single Color", "price_per_unit": 1000 }
                    ]
                },
                "Mat Cards": {
                    "All Options": [
                        { "Size": "3.5x2", "Quality": "Standard", "Shape": "Round Corners", "Sides": "Double Side", "Finish": "Mat", "price_per_unit": 1200 },
                        { "Size": "3.5x2", "Quality": "Standard", "Shape": "Plain Corners", "Sides": "Double Side", "Finish": "Mat", "price_per_unit": 1000 }
                    ],
                    "Plain Corners": { "Custom": [{ "Printing Side": "Single side", "price_per_unit": 1900.0 }, { "Printing Side": "Double side", "price_per_unit": 2000.0 }] },
                    "Round Corners": { "Custom": [{ "Printing Side": "Single side", "price_per_unit": 2300.0 }, { "Printing Side": "Double side", "price_per_unit": 3000.0 }] }
                },
                "UV Cards": {
                    "All Options": [
                        { "Size": "3.5x2", "Quality": "Standard", "Shape": "Round Corners", "Sides": "Double Side", "Finish": "UV", "price_per_unit": 1500 }
                    ]
                },
                "Visisting Cards": {
                    "All Options": [
                        { "Finish": "Shine", "Size/Type": "Custom", "Printing Side": "Single side", "price_per_unit": 1800.0 },
                        { "Finish": "Shine", "Size/Type": "Custom", "Printing Side": "Double side", "price_per_unit": 2000.0 }
                    ]
                }
            },
            "Marketing Essentials": {
                "Pamphlets": {
                    "All Options": [
                        { "Size": "5.75x9", "Weight": "68 gms", "price_per_unit": 1.5 }, { "Size": "5.75x9", "Weight": "68 gms", "price_per_unit": 2.0 }, { "Size": "5.75x9", "Weight": "68 gms", "price_per_unit": 3.0 },
                        { "Size": "5.75x9", "Weight": "80gms", "price_per_unit": 2.0 }, { "Size": "5.75x9", "Weight": "80gms", "price_per_unit": 2.5 }, { "Size": "5.75x9", "Weight": "80gms", "price_per_unit": 4.0 },
                        { "Size": "A4", "Weight": "68 gms", "price_per_unit": 5.0 }, { "Size": "A4", "Weight": "80gms", "price_per_unit": 7.0 }
                    ]
                },
                // ... other marketing products (Flyers/Stickers omitted for brevity, but should be handled by extending the logic)
            },
            "Office Essentials": {
                "Letterpads": {
                    "All Options": [
                        { "Size": "5.75x9", "Weight": "68 gms", "Printing Color": "Single Color", "price_per_unit": 2.5 }, { "Size": "5.75x9", "Weight": "68 gms", "Printing Color": "Two Colors", "price_per_unit": 3.0 }, { "Size": "5.75x9", "Weight": "68 gms", "Printing Color": "4 Colors", "price_per_unit": 4.5 },
                        { "Size": "5.75x9", "Weight": "80gms", "Printing Color": "Single Color", "price_per_unit": 3.0 }, { "Size": "5.75x9", "Weight": "80gms", "Printing Color": "Two Colors", "price_per_unit": 3.5 }, { "Size": "5.75x9", "Weight": "80gms", "Printing Color": "4 Colors", "price_per_unit": 5.0 },
                        { "Size": "5.75x9", "Weight": "100 gms", "Printing Color": "Single Color", "price_per_unit": 4.0 }, { "Size": "5.75x9", "Weight": "100 gms", "Printing Color": "Two Colors", "price_per_unit": 4.5 }, { "Size": "5.75x9", "Weight": "100 gms", "Printing Color": "4 Colors", "price_per_unit": 6.0 },
                        { "Size": "A4", "Weight": "68 gms", "Printing Color": "Single Color", "price_per_unit": 4.0 }, { "Size": "A4", "Weight": "68 gms", "Printing Color": "Two Colors", "price_per_unit": 5.0 }, { "Size": "A4", "Weight": "68 gms", "Printing Color": "4 Colors", "price_per_unit": 7.0 },
                        { "Size": "A4", "Weight": "80gms", "Printing Color": "Single Color", "price_per_unit": 4.5 }, { "Size": "A4", "Weight": "80gms", "Printing Color": "Two Colors", "price_per_unit": 5.5 }, { "Size": "A4", "Weight": "80gms", "Printing Color": "4 Colors", "price_per_unit": 8.0 },
                        { "Size": "A4", "Weight": "100 gms", "Printing Color": "Single Color", "price_per_unit": 5.0 }, { "Size": "A4", "Weight": "100 gms", "Printing Color": "Two Colors", "price_per_unit": 6.0 }, { "Size": "A4", "Weight": "100 gms", "Printing Color": "4 Colors", "price_per_unit": 9.0 }
                    ]
                },
                "Bill Books": {
                    "All Options": [
                        { "Size": "5.75x9", "Paper Type": "68 gms", "Printing Color": "Single Color", "price_per_unit": 10.0 }, { "Size": "5.75x9", "Paper Type": "80gms", "Printing Color": "4 Colors", "price_per_unit": 12.0 }, { "Size": "5.75x9", "Paper Type": "90gms Art Paper", "Printing Color": "4 Colors", "price_per_unit": 15.0 }, { "Size": "5.75x9", "Paper Type": "100 gms", "Printing Color": "4 Colors", "price_per_unit": 18.0 },
                        { "Size": "A4", "Paper Type": "68 gms", "Printing Color": "Single Color", "price_per_unit": 15.0 }, { "Size": "A4", "Paper Type": "80gms", "Printing Color": "Single Color", "price_per_unit": 18.0 }, { "Size": "A4", "Paper Type": "90gms Art Paper", "Printing Color": "4 Colors", "price_per_unit": 22.0 }, { "Size": "A4", "Paper Type": "100 gms", "Printing Color": "4 Colors", "price_per_unit": 25.0 },
                        { "Size": "9x11", "Paper Type": "80gms", "Printing Color": "4 Colors", "price_per_unit": 28.0 }, { "Size": "9x11", "Paper Type": "100 gms", "Printing Color": "4 Colors", "price_per_unit": 32.0 }
                    ]
                },
                // ... other office products
            }
        };

        const catalogContainer = document.getElementById('catalog-container');

        // --- CORE LOGIC ---

        function renderCatalog() {
            catalogContainer.innerHTML = ''; // Clear previous content

            for (const category in productData) {
                if (Object.hasOwnProperty.call(productData, category)) {
                    catalogContainer.innerHTML += `<h2 class="category-title">${category}</h2>`;

                    const products = productData[category];
                    for (const productName in products) {
                        if (Object.hasOwnProperty.call(products, productName)) {
                            const product = products[productName];

                            // Only process products that have the standardized "All Options" array
                            if (product.hasOwnProperty('All Options') && Array.isArray(product['All Options'])) {
                                const options = product['All Options'];
                                renderProductCard(productName, options);
                            } 
                            // Skip non-standard/unflatted products (like "Flyers/Ishtihars" or sub-options)
                        }
                    }
                }
            }
        }

        function renderProductCard(name, options) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `<h3 class="product-title">${name}</h3>`;

            // 1. Identify all unique variation attributes (e.g., 'Size', 'Weight', 'Color')
            const attributes = {};
            options.forEach(option => {
                for (const key in option) {
                    // Exclude price_per_unit and other non-variation keys
                    if (key !== 'price_per_unit' && key !== 'id') {
                        if (!attributes[key]) {
                            attributes[key] = new Set();
                        }
                        attributes[key].add(option[key]);
                    }
                }
            });

            const selectorsDiv = document.createElement('div');
            selectorsDiv.className = 'product-options';
            card.appendChild(selectorsDiv);

            // 2. Render clickable tags for each attribute
            for (const attrName in attributes) {
                const uniqueValues = Array.from(attributes[attrName]);
                
                const attrHeader = document.createElement('div');
                attrHeader.textContent = `${attrName}:`;
                selectorsDiv.appendChild(attrHeader);
                
                uniqueValues.forEach(value => {
                    const tag = document.createElement('span');
                    tag.className = 'variation-tag';
                    tag.textContent = value;
                    tag.setAttribute('data-attr', attrName);
                    tag.setAttribute('data-value', value);
                    tag.onclick = (e) => updatePrice(e.target, name, options);
                    selectorsDiv.appendChild(tag);
                });
            }

            // 3. Initial Price Display
            const priceDiv = document.createElement('div');
            priceDiv.id = `price-${name.replace(/\s+/g, '-')}`;
            priceDiv.className = 'price-display';
            priceDiv.textContent = `Starting Price: ${options[0].price_per_unit || 'N/A'}`;
            card.appendChild(priceDiv);

            catalogContainer.appendChild(card);
        }

        function updatePrice(clickedTag, productName, options) {
            const productCard = clickedTag.closest('.product-card');
            const attrName = clickedTag.getAttribute('data-attr');
            const attrValue = clickedTag.getAttribute('data-value');

            // Toggle selection for the clicked attribute group
            const tags = productCard.querySelectorAll(`[data-attr="${attrName}"]`);
            tags.forEach(tag => tag.classList.remove('selected'));
            clickedTag.classList.add('selected');

            // 1. Collect all currently selected attributes
            const currentSelections = {};
            productCard.querySelectorAll('.variation-tag.selected').forEach(tag => {
                currentSelections[tag.getAttribute('data-attr')] = tag.getAttribute('data-value');
            });

            // 2. Find the matching price option
            let foundPrice = '---';
            let matchCount = 0;
            let bestMatch = null;
            
            options.forEach(option => {
                let currentMatchCount = 0;
                let isMatch = true;

                for (const key in currentSelections) {
                    if (option.hasOwnProperty(key) && String(option[key]) === currentSelections[key]) {
                        currentMatchCount++;
                    } else if (option.hasOwnProperty(key)) {
                        isMatch = false;
                        break;
                    }
                }

                if (isMatch && currentMatchCount > 0) {
                    if (currentMatchCount > matchCount) {
                         matchCount = currentMatchCount;
                         bestMatch = option;
                    }
                }
            });

            // 3. Update the display
            const priceDiv = document.getElementById(`price-${productName.replace(/\s+/g, '-')}`);
            if (bestMatch) {
                priceDiv.textContent = `Price: ${bestMatch.price_per_unit}`;
            } else {
                priceDiv.textContent = `Please select all options for final price.`;
            }
        }

        // Initialize the page
        renderCatalog();

    </script>

</body>
</html>
