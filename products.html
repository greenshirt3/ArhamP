<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Arham Printers - Product Catalog</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Printing Services, Business Cards, Stationery, Marketing Materials, Full Catalog" name="keywords">
    <meta content="Explore the full range of professional printing services and product catalog from Arham Printers." name="description">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <style>
        /* General Layout and Utility Styles */
        :root {
            --bs-primary: #f28b00; /* Assuming this is your primary color */
            --bs-secondary: #ff5722; /* Example secondary color */
            --bs-dark: #212529;
            --mobile-nav-height: 60px;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .final-price-box {
            background: var(--bs-primary);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            text-align: center;
            display: none; 
        }
        .final-price-box h4 {
            color: white;
        }
        
        /* ---------------------------------------------------- */
        /* RESPONSIVE HEADER IMAGE IMPLEMENTATION (NEW LOGIC) */
        /* ---------------------------------------------------- */
        .page-header {
            /* Default: Use Mobile Image (Mobile First Approach) */
            background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url(img/banners/productmobile.webp) center center no-repeat;
            background-size: cover;
            min-height: 250px;
        }

        @media (min-width: 768px) {
            .page-header {
                /* Override: Use Desktop Image on larger screens */
                background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url(img/banners/productdesk.webp) center center no-repeat;
                background-size: cover;
                min-height: 350px;
            }
        }
        /* ---------------------------------------------------- */
        
        /* --- DESKTOP NAV FIX --- */
        /* Remove margin from h1 inside the desktop navbar brand for alignment */
        .navbar-brand h1 {
            margin-top: 0;
            margin-bottom: 0;
        }

        /* Clickable Card Variations (Standard Items) */
        .choice-card {
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            text-align: center;
            transition: all 0.2s ease;
            flex-grow: 1;
            min-width: 120px;
            opacity: 1; /* Default to visible */
        }
        .choice-card:hover {
            border-color: var(--bs-secondary);
            background-color: #fff8f8;
        }
        .choice-card.selected {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary);
            color: white;
            box-shadow: 0 0 10px rgba(242, 139, 0, 0.3);
        }
        /* Style for visually disabling non-selectable options */
        .choice-card.disabled {
            opacity: 0.5;
            pointer-events: none; /* Disable interaction */
            border-color: #eee;
            background-color: #f7f7f7;
        }
        .choice-card input[type="radio"] {
            display: none;
        }
        .choice-card .label-text {
            font-weight: 500;
            color: var(--bs-dark);
            display: block;
        }
        .choice-card.selected .label-text {
            color: white;
        }
        .product-option-group {
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .product-option-group label {
            font-weight: 600;
            color: var(--bs-dark);
            margin-bottom: 0.75rem;
            display: block;
            font-size: 1.1rem;
        }

        /* --- MOBILE BOTTOM NAVIGATION STYLES --- */

        /* 1. Mobile Bottom Bar Container */
        #mobile-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--mobile-nav-height);
            background: white;
            border-top: 1px solid #ddd;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1030;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        
        /* **FIX 1: Ensure all 5 top-level elements take equal width** */
        #mobile-bottom-nav > a, 
        #mobile-bottom-nav > div {
            flex: 1 1 0%; /* Equal distribution: 20% width per slot */
        }

        /* 2. Mobile Link Styling */
        .mobile-nav-link {
            flex: 1; 
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            text-decoration: none;
            color: var(--bs-dark);
            font-size: 0.6rem; /* Smaller text for compact look */
            padding: 5px 0;
            transition: color 0.2s;
            position: relative;
            height: 100%;
            justify-content: center;
        }
        .mobile-nav-link:hover {
             color: var(--bs-primary);
        }
        .mobile-nav-link i {
            font-size: 1.1rem;
            margin-bottom: 2px;
            line-height: 1;
        }
        .mobile-nav-link.active {
            color: var(--bs-primary);
        }
        

/* Update the existing #mobile-nav-logo section */
/* 3. Center Logo Button */
#mobile-nav-logo {
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* Make it relative for absolute children */
}
#mobile-nav-logo a {
            background-color: var(--bs-primary);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(242, 139, 0, 0.6);
            position: absolute; 
            top: -15px; 
            /* **FIX 2: Center absolutely positioned element within its slot** */
            left: 50%;
            transform: translateX(-50%); 
}

/* NEW RULE: Style the image inside the centered mobile button */
#mobile-nav-logo a img {
    /* Ensures the image is centered and prevents vertical alignment issues */
    vertical-align: middle; 
    /* Ensures the image doesn't overflow the 45px circle container */
    max-width: 80%; 
    max-height: 80%;
    height: auto !important; /* Overrides inline height if needed, maintaining aspect ratio */
}

#mobile-nav-logo a i {
            font-size: 1.5rem;
}
        /* 4. Content Padding to clear the fixed bottom nav */
        #shop-catalog-section, #product-detail-section, #quote-section, #contact-section {
            padding-bottom: calc(var(--mobile-nav-height) + 15px); /* Add space for the bottom navbar */
        }
        
        /* 5. Compact Category Link Styling (Removed, but keeping class definitions minimal) */
        .categories-item a {
            font-size: 0.75rem; 
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 0;
            line-height: 1.2;
        }
        .categories-item a i {
            font-size: 1.2rem; 
            margin-bottom: 5px !important;
        }
        
        /* 6. Mobile Dropdown Specific Styling */
        #mobile-bottom-nav .dropdown-menu {
            position: absolute;
            bottom: var(--mobile-nav-height); /* Position above the nav bar */
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            border-radius: 8px 8px 0 0;
            padding: 10px 0;
        }
        #mobile-bottom-nav .dropdown-item {
             font-size: 0.8rem;
        }
    </style>
</head>

<body>
    <div class="container">
    <div class="container-fluid bg-dark text-white-50 py-2 px-0 d-none d-lg-block">
        <div class="row gx-0 align-items-center">
            <div class="col-lg-7 px-5 text-start">
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="fa fa-phone-alt me-2"></small>
                    <small>+92 300 6238233</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-envelope-open me-2"></small>
                    <small>info@arhamprinters.pk</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-clock me-2"></small>
                    <small>Mon - Fri : 09 AM - 09 PM</small>
                </div>
            </div>
            <div class="col-lg-5 px-5 text-end">
                <div class="h-100 d-inline-flex align-items-center">
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-twitter"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top px-4 px-lg-5 d-none d-lg-block">
    
    <div class="d-flex w-100 justify-content-between align-items-center">
        
        <a href="index.html" class="navbar-brand d-flex align-items-center me-4">
            <img src="img/logo2.webp" alt="Arham Printers Logo" style="height: 40px; margin-right: 1rem;">
                  </a>

        <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse flex-grow-1" id="navbarCollapse">
            <div class="navbar-nav me-auto bg-light pe-4 py-3 py-lg-0 d-flex align-items-center">
                
                <a href="index.html" class="nav-item nav-link">Home</a>
                <a href="#" class="nav-item nav-link active" onclick="showSection('shop-catalog')">Products</a>
                <a href="wedding.html" class="nav-item nav-link">Wedding Cards</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Shop</a>
                    <div class="dropdown-menu bg-light border-0 m-0">
                        <a href="#" class="dropdown-item" onclick="showSection('shop-catalog')">All Products</a>
                        <a href="#quote-section" class="dropdown-item" onclick="showSection('quote')">Get Custom Quote</a>
                    </div>
                </div>
                <a href="#contact-section" class="nav-item nav-link" onclick="showSection('contact')">Contact</a>
            </div>
            
            <div class="h-100 d-lg-inline-flex align-items-center">
                <a class="btn-sm-square bg-white text-primary rounded-circle me-4 position-relative" href="#quote-section" onclick="showSection('quote')">
                    <i class="fas fa-file-invoice"></i>
                </a>
                <a href="#contact-section" class="btn btn-primary py-2 px-3 rounded-0 d-none d-lg-block" onclick="showSection('quote')">Get a Quote<i
                        class="fa fa-arrow-right ms-3"></i></a>
            </div>
        </div>
    </div>
</nav>

    <nav id="mobile-bottom-nav" class="d-lg-none">
    <a href="index.html" class="mobile-nav-link" id="mobile-link-home">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </a>
    
    <div class="nav-item dropup d-flex flex-fill justify-content-center">
         <a href="#" class="mobile-nav-link dropdown-toggle" data-bs-toggle="dropdown" id="mobile-link-categories">
             <i class="fas fa-th-large"></i>
             <span>Categories</span>
         </a>
        <div class="dropdown-menu bg-light border-0">
             <a href="#business-essentials" class="dropdown-item" onclick="showSection('shop-catalog')">Business & Office Essentials</a>
             <a href="#marketing-essentials" class="dropdown-item" onclick="showSection('shop-catalog')">Marketing & Promotional Items</a>
             <a href="#digital-media" class="dropdown-item" onclick="showSection('shop-catalog')">Digital Media Marketing</a>
             <a href="#banners" class="dropdown-item" onclick="showSection('shop-catalog')">Custom & Large Format</a>
             <a href="print-order.html" class="dropdown-item">B/W and Color Prints</a>
             <a href="wedding.html" class="dropdown-item">Special Occasions (Wedding)</a>
        </div>
    </div>
    
    <div id="mobile-nav-logo">
         <a href="index.html" class="mobile-nav-link-center">
             <img src="img/logo.webp" alt="Logo" style="height: 80px;">
         </a>
    </div>
    
    <a href="#main-product-catalog" class="mobile-nav-link active" onclick="showSection('shop-catalog')" id="mobile-link-products">
        <i class="fas fa-th-list"></i>
        <span>Products</span>
    </a>
    
    <a href="wedding.html" class="mobile-nav-link" id="mobile-link-wedding">
        <i class="fas fa-gift"></i>
        <span>Wedding Cards</span>
    </a>
</nav>
    
    <section id="shop-catalog-section" class="section active">
        <div class="container-fluid page-header py-5">
            <h2 class="text-center display-6">Products and Services</h2>
        </div>
    
  <div class="container py-5">
            
            <div class="row g-4" id="main-product-catalog">
                
                <h3 class="w-100 pt-3" id="business-essentials">Business & Office Essentials</h3>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/vcard.webp' onerror="this.onerror=null;this.src='img/products/vcard.png';" class='w-100' alt='Shine Visisting Cards'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Shine Visisting Cards')">
                                <i class="fas fa-search me-2"></i> Shine Visisting Cards
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/matcards.webp' onerror="this.onerror=null;this.src='img/products/matcards.png';" class='w-100' alt='Mat Cards'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Mat Cards')">
                                <i class="fas fa-search me-2"></i> Mat Cards
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/uvcard.webp' onerror="this.onerror=null;this.src='img/products/uvcard.png';" class='w-100' alt='UV Cards'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('UV Cards')">
                                <i class="fas fa-search me-2"></i> UV Cards
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/thickcard.webp' onerror="this.onerror=null;this.src='img/products/thickcard.png';" class='w-100' alt='UV Thick Cards'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('UV Thick Cards')">
                                <i class="fas fa-search me-2"></i> UV Thick Cards
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/letterpad.webp' onerror="this.onerror=null;this.src='img/products/letterpad.png';" class='w-100' alt='Letterpad'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Letterpads')">
                                <i class="fas fa-search me-2"></i> Letterpads
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/envelops.webp' onerror="this.onerror=null;this.src='img/products/envelops.png';" class='w-100' alt='envelops'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Envelops')">
                                <i class="fas fa-search me-2"></i> Envelops
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/billbooks.webp' onerror="this.onerror=null;this.src='img/products/billbooks.png';" class='w-100' alt='Bill Books'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Bill Books')">
                                <i class="fas fa-search me-2"></i> Bill Books
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/file.webp' onerror="this.onerror=null;this.src='img/products/filecovers.png';" class='w-100' alt='File Covers'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('File Covers')">
                                <i class="fas fa-search me-2"></i> File Covers
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/stamps.webp' onerror="this.onerror=null;this.src='img/products/stamps.png';" class='w-100' alt='Rubber Stamp (Rectangular)'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Rubber Stamp (Rectangular)')">
                                <i class="fas fa-search me-2"></i> Rubber Stamp (Rectangular)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/penciltray.png';" class='w-100' alt='Pencil Tray'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Pencil Tray')">
                                <i class="fas fa-search me-2"></i> Pencil Tray
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="w-100" />

                <h3 class="w-100 pt-3" id="marketing-essentials">Marketing & Promotional Items</h3>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/pamphlet.webp' onerror="this.onerror=null;this.src='img/products/pamphlets.png';" class='w-100' alt='pamphlets'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Ishtihar')">
                                <i class="fas fa-search me-2"></i> Pamphlets
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/flyers.webp' onerror="this.onerror=null;this.src='img/products/flyers.png';" class='w-100' alt='Flyers/Ishtihars'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Flyers/Ishtihars')">
                                <i class="fas fa-search me-2"></i> Flyers/Ishtihars
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/stickers.webp' onerror="this.onerror=null;this.src='img/products/Stickers.png';" class='w-100' alt='Stickers'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Stickers')">
                                <i class="fas fa-search me-2"></i> Stickers
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/shirt.webp' onerror="this.onerror=null;this.src='img/products/shirt.png';" class='w-100' alt='White T-Shirt (Adult Size)'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('White T-Shirt (Adult Size)')">
                                <i class="fas fa-search me-2"></i> White T-Shirt (Adult Size)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/mugs.webp' onerror="this.onerror=null;this.src='img/products/Mug.png';" class='w-100' alt='Mug'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Mug')">
                                <i class="fas fa-search me-2"></i> Mug
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/metal.webp' onerror="this.onerror=null;this.src='img/products/pen.png';" class='w-100' alt='Metal Pen'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Metal Pen')">
                                <i class="fas fa-search me-2"></i> Metal Pen
                            </button>
                        </div>
                    </div>
                </div>

                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/locket.png';" class='w-100' alt='Locket with Picture'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Locket with Picture')">
                                <i class="fas fa-search me-2"></i> Locket with Picture
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="w-100" />

                <h3 class="w-100 pt-3" id="digital-media">Digital Media Marketing</h3>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Digital Media Quote'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showSection('quote')">
                                <i class="fas fa-chart-line me-2"></i> Inquire about Campaigns
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="w-100" />

                <h3 class="w-100 pt-3" id="banners">Custom & Large Format</h3>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/china.webp' onerror="this.onerror=null;this.src='img/products/china.png';" class='w-100' alt='China Frontlit'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('China Frontlit')">
                                <i class="fas fa-search me-2"></i> China Frontlit (Area)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/star.webp' onerror="this.onerror=null;this.src='img/products/star.png';" class='w-100' alt='Star Frontlit'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Star Frontlit')">
                                <i class="fas fa-search me-2"></i> Star Frontlit (Area)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/backlit.webp' onerror="this.onerror=null;this.src='img/products/backlit.png';" class='w-100' alt='Panaflex Banner Backlit'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Panaflex Banner Backlit')">
                                <i class="fas fa-search me-2"></i> Panaflex Banner Backlit (Area)
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='OneVision Banner'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('OneVision')">
                                <i class="fas fa-search me-2"></i> OneVision (Area)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Venyl Sticker'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Venyl')">
                                <i class="fas fa-search me-2"></i> Venyl (Area)
                            </button>
                        </div>
                    </div>
                </div>

                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/photos.webp' onerror="this.onerror=null;this.src='img/products/photopapers.png';" class='w-100' alt='Photo Papers'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Photo Printing')">
                                <i class="fas fa-search me-2"></i> Photo Papers
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/frames.webp' onerror="this.onerror=null;this.src='img/products/frames.png';" class='w-100' alt='Photo Frames'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('Photo Frames')">
                                <i class="fas fa-search me-2"></i> Configure Photo Frames (Area)
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/wallpapers.webp' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='3D Wallpaper'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showProductDetails('3D Wallpaper Placeholder')">
                                <i class="fas fa-search me-2"></i> Configure Wallpaper (Area)
                            </button>
                        </div>
                    </div>
                </div>

                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Shields'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showSection('quote')">
                                <i class="fas fa-file-invoice me-2"></i> Shields (Custom Quote)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Flags and Fabric'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showSection('quote')">
                                <i class="fas fa-file-invoice me-2"></i> Flags & Fabric (Custom Quote)
                            </button>
                        </div>
                    </div>
                </div>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/box.webp' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Box Packaging'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showSection('quote')">
                                <i class="fas fa-file-invoice me-2"></i> Box Packaging (Custom Quote)
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="w-100" />

                <h3 class="w-100 pt-3" id="prints-and-documents">B/W and Color Prints</h3>
                
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/digital.webp' onerror="this.onerror=null;this.src='img/products/prints.png';" class='w-100' alt='Digital Print Order'>
                        <div class="product-footer-overlay p-0">
                            <a class="btn btn-primary w-100 rounded-0 p-3" href="print-order.html">
                                <i class="fas fa-print me-2"></i> Upload Documents for Print
                            </a>
                        </div>
                    </div>
                </div>

                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Tiered Digital Printing Price Calculator'>
                        <div class="product-footer-overlay p-0">
                            <button class="btn btn-secondary w-100 rounded-0 p-3" onclick="showProductDetails('Digital Print (Tiered)')">
                                <i class="fas fa-calculator me-2"></i> View Price Calculator
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="w-100" />
                
                <h3 class="w-100 pt-3" id="wedding-cards">Special Occasions (Wedding Cards)</h3>
                <div class='col-lg-3 col-6 mb-4'>
                    <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                        <img src='img/products/placeholder.png' onerror="this.onerror=null;this.src='img/products/placeholder.png';" class='w-100' alt='Wedding Card Catalog Link'>
                        <div class="product-footer-overlay p-0">
                            <a class="btn btn-primary w-100 rounded-0 p-3" href="wedding.html">
                                <i class="fas fa-gift me-2"></i> View Wedding Catalog
                            </a>
                        </div>
                    </div>
                </div>
                
            </div>
        <div class="container mt-5">
            <div class="text-center mb-4">
                <h3>Need Custom Printing or Service not listed?</h3>
                <p class="text-muted">For bespoke designs, complex finishes, or any custom job, contact us directly.</p>
                <button class="btn btn-primary rounded-0 btn-lg" onclick="showSection('quote')">
                    <i class="fas fa-file-invoice me-2"></i>Get a Custom Quote
                </button>
            </div>
        </div>
    </section>
    <section id="product-detail-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6" id="detail-product-name-header">Product Details</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="#" onclick="showSection('shop-catalog')">Catalog</a></li>
                <li class="breadcrumb-item active text-white">Details</li>
            </ol>
        </div>

        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-lg-6">
                        <div class="d-flex justify-content-center">
                            <picture>
                                <source id="detail-product-image-webp" srcset="img/products/placeholder.webp" type="image/webp">
                                <img id="detail-product-image" src="img/products/placeholder.png" class="img-fluid rounded" alt="Product Image" style="max-height: 400px;">
                            </picture>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <h2 class="fw-bold mb-4" id="detail-product-name-body">Product Name</h2>
                        
                        <div id="custom-area-inputs" style="display: none;">
                            <div class="product-option-group" data-option-key="Dimensions">
                                <label>Wall/Piece Dimensions (Feet):</label>
                                <div class="d-flex gap-3">
                                    <input type="number" id="input-width" min="1" placeholder="Width" class="form-control" oninput="updateFinalPrice()">
                                    <span class="align-self-center">x</span>
                                    <input type="number" id="input-height" min="1" placeholder="Height" class="form-control" oninput="updateFinalPrice()">
                                </div>
                                <small class="text-muted mt-2 d-block" id="areaDisplay"></small>
                            </div>
                            
                            <div class="product-option-group" data-option-key="Quantity">
                                <label>Number of Pieces/Walls:</label>
                                <input type="number" id="input-custom-qty" min="1" value="1" class="form-control" oninput="updateFinalPrice()">
                            </div>
                            
                            <div class="alert alert-danger mt-3" id="areaConstraintWarning" style="display: none;"></div>
                        </div>

                        <div id="standard-options-fields">
                            </div>

                        <div class="final-price-box" id="finalPriceBox">
                            <h4 class="mb-2">Final Price (PKR)</h4>
                            <h3 class="display-6 fw-bold" id="finalPriceDisplay">PKR 0</h3>
                            
                            <button class="btn btn-primary py-2 px-4 w-100 mt-3" onclick="submitOrder('product_order')">
                                <i class="fas fa-envelope me-2"></i> Place Order
                            </button>
                        </div>
                        
                        <div class="alert alert-info mt-3" id="selectionWarning" style="display: block;">
                            Please enter dimensions/quantity or select all options above to see the final price.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="quote-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">Get a Custom Quote</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active text-white">Quote</li>
            </ol>
        </div>

        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row g-4 justify-content-center">
                    <div class="col-lg-8">
                        <div class="bg-light p-4 rounded">
                            <form id="quote-form" onsubmit="handleQuoteSubmission(event)">
                                <h3 class="mb-4">Quick Inquiry</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0" id="quote-name" placeholder="Your Name" required>
                                            <label for="quote-name">Your Name</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="tel" class="form-control border-0" id="quote-phone" placeholder="WhatsApp Phone" required>
                                            <label for="quote-phone">WhatsApp Phone</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0" id="quote-product" placeholder="Product Name (e.g., Visiting Cards, 3D Wallpaper)">
                                            <label for="quote-product">Product Name / Type</label>
                                        </div>
                                    </div>
                                     <div class="col-12">
                                        <div class="form-floating">
                                            <input type="number" class="form-control border-0" id="quote-quantity" placeholder="Quantity or Total Area (e.g., 500 cards, 100 sq ft)">
                                            <label for="quote-quantity">Quantity / Estimated Area</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <textarea class="form-control border-0" placeholder="Details of your inquiry (Size, Finish, Quality, Message)" id="quote-details" style="height: 150px" required></textarea>
                                            <label for="quote-details">Inquiry Message / Specifications</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <button class="btn btn-primary w-100 py-3" type="submit">Submit Quote via WhatsApp</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    <section id="contact-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">Contact Us</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active text-white">Contact</li>
            </ol>
        </div>

        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row g-4">
                    <div class="col-lg-4">
                        <div class="bg-light p-4 rounded">
                            <div class="d-flex align-items-center mb-4">
                                <div class="d-flex align-items-center justify-content-center border border-primary rounded-circle mb-3"
                                    style="width: 60px; height: 60px;">
                                    <i class="fa fa-map-marker-alt text-primary fs-4"></i>
                                </div>
                                <div class="ms-4">
                                    <h5 class="mb-2">Our Location</h5>
                                    <p class="mb-0">Domela Chowk,Tanda Road, Jalalpur Jattan</p>
                                </div>
                            </div>
                            
                            <div class="d-flex align-items-center mb-4">
                                <div class="d-flex align-items-center justify-content-center border border-primary rounded-circle mb-3"
                                    style="width: 60px; height: 60px;">
                                    <i class="fa fa-phone-alt text-primary fs-4"></i>
                                </div>
                                <div class="ms-4">
                                    <h5 class="mb-2">Call Us</h5>
                                    <p class="mb-0">+92 300 6238233</p>
                                </div>
                            </div>
                            
                            <div class="d-flex align-items-center">
                                <div class="d-flex align-items-center justify-content-center border border-primary rounded-circle mb-3"
                                    style="width: 60px; height: 60px;">
                                    <i class="fa fa-envelope text-primary fs-4"></i>
                                </div>
                                <div class="ms-4">
                                    <h5 class="mb-2">Email Us</h5>
                                    <p class="mb-0">info@arhamprinters.pk</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="bg-light p-4 rounded">
                            <form id="contact-form-whatsapp" onsubmit="handleContactSubmission(event)">
                                <h3 class="mb-4">Send a Direct Message</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0" id="contact-name" placeholder="Your Name" required>
                                            <label for="contact-name">Your Name</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0" id="contact-subject" placeholder="Subject" required>
                                            <label for="contact-subject">Subject</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <textarea class="form-control border-0" placeholder="Leave a message here" id="contact-message" style="height: 150px" required></textarea>
                                            <label for="contact-message">Message</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <button class="btn btn-primary w-100 py-3" type="submit">Send Message via WhatsApp</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
           <div class="container-fluid footer py-2">
            <div class="container py-2">
                <div class="row g-3">
                    <div class="col-6 col-md-3">
                        <div class="rounded p-2 d-flex flex-column align-items-center">
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto"
                                style="width: 56px; height: 56px;">
                                <i class="fas fa-map-marker-alt fa-2x text-primary" style="line-height: 1;"></i>
                            </div>
                            <h6 class="text-white mt-1 mb-1">Address</h6>
                            <p class="text-white fw-bold mb-1 small text-center">Domela Chowk, Tanda Road, Jalalpur Jattan
                            </p>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="rounded p-2 d-flex flex-column align-items-center">
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto"
                                style="width: 56px; height: 56px;">
                                <i class="fas fa-envelope fa-2x text-primary" style="line-height: 1;"></i>
                            </div>
                            <h6 class="text-white mt-1 mb-1">Mail Us</h6>
                            <p class="text-white fw-bold mb-1 small text-center">info@arhamprinters.pk</p>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="rounded p-2 d-flex flex-column align-items-center">
                            <a href="https://wa.me/923006238233" target="_blank" class="text-decoration-none">
                                <div class="rounded-circle bg-success d-flex align-items-center justify-content-center mb-2 mx-auto"
                                    style="width: 56px; height: 56px;">
                                    <i class="fab fa-whatsapp fa-2x text-white" style="line-height: 1;"></i>
                                </div>
                            </a>
                            <h6 class="text-white mt-1 mb-1">Direct Contact</h6>
                            <a href="https://wa.me/923006238233" target="_blank"
                                class="text-white-50 text-decoration-none">
                                <p class="text-white fw-bold mb-1 small text-center">+92 300 6238233</p>
                            </a>
                        </div>
                    </div>

                    <div class="col-6 col-md-3">
                        <div class="rounded p-2 d-flex flex-column align-items-center">
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-2 mx-auto"
                                style="width: 56px; height: 56px;">
                                <i class="fab fa-facebook-f fa-2x text-primary" style="line-height: 1;"></i>
                            </div>
                            <h6 class="text-white mt-1 mb-1">Follow Us</h6>
                            <div class="d-flex justify-content-center gap-1">
                                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i
                                        class="fab fa-twitter"></i></a>
                                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i
                                        class="fab fa-facebook-f"></i></a>
                                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i
                                        class="fab fa-youtube"></i></a>
                                <a class="btn btn-square btn-outline-light rounded-circle" href="#"><i
                                        class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid copyright py-2">
                <div class="container">
                    <div class="row">
                        <div class="col-12 text-center">
                            <span class="text-white small">
                                <i class="fas fa-copyright text-light me-1"></i>
                                Arham Printers, All rights reserved 2025.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

    <script>
    // --- Configuration (UPDATED) ---
    const PUBLIC_DATA_URL = 'all_prices.json'; // Now fetching from the local JSON file
    const WHATSAPP_NUMBER = '923006238233'; 
    const SUBMIT_ORDER_URL = 'submit_order.php'; 
    
    let allProducts = {}; 
    let currentProduct = null; 
    let allProductGroups = {};
    let currentSelectedVariations = {}; 
    
    // 🛑 NEW: Area-Based Pricing & Profit Constants 🛑
      const AREA_BASED_META = {
        "China Frontlit": { is_area_based: true, rate: 35, min_area: 2, category: 'Banners' }, 
        "Star Frontlit": { is_area_based: true, rate: 65, min_area: 2, category: 'Banners' },
        "Panaflex Banner Backlit": { is_area_based: true, rate: 100, min_area: 2, category: 'Banners' }, 
        "OneVision": { is_area_based: true, rate: 90, min_area: 2, category: 'Banners' }, 
        "Venyl": { is_area_based: true, rate: 90, min_area: 2, category: 'Banners' },    
        "3D Wallpaper Placeholder": { is_area_based: true, rate: 30, min_area: 20, category: '3D Wallpaper' },
        "Photo Frames": { is_area_based: true, rate: 40, min_area: 1, category: 'Photo Printing' } 
    };
    
    const AREA_BASED_PRODUCT_NAMES = Object.keys(AREA_BASED_META);

    // NEW: Tiered Design Charges (Based on Area and Quantity)
    const DESIGN_FEE_TIERS = [
        { min_sqft: 1, max_sqft: 10, base_fee: 300 },
        { min_sqft: 11, max_sqft: 24, base_fee: 400 },
        { min_sqft: 25, max_sqft: 50, base_fee: 500 },
        { min_sqft: 51, max_sqft: Infinity, base_fee: 700 },
    ];
    const DESIGN_FEE_QTY_INCREMENT = 50;
    const DESIGN_FEE_QTY_THRESHOLD = 5;

    // NEW: Tiered Profit Margins (Based on Quantity)
    const AREA_PROFIT_TIERS = [
        { min_qty: 1, max_qty: 10, multiplier: 1.20 }, // 20%
        { min_qty: 11, max_qty: 20, multiplier: 1.18 }, // 18%
        { min_qty: 21, max_qty: 30, multiplier: 1.16 }, // 16%
        { min_qty: 31, max_qty: 50, multiplier: 1.14 }, // 14%
        { min_qty: 51, max_qty: Infinity, multiplier: 1.10 }, // 10%
    ];
    
    let digitalPrintingPricing = {};

    // Map the generic SQL column name to a user-friendly display name
    const variantDisplayNames = {
        'variant_1': 'Size', 
        'variant_2': 'Material/Stock', 
        'variant_3': 'Type/Finish', 
        'side_print': 'Print Sides', 
        'material_type': 'Material Type', 
        'shape_type': 'Inking Mechanism', 
        'type_group': 'Card Type', 
        'accessories': 'Accessories', 
        'single_side': 'Print Color (Single Side)',
        'double_side': 'Print Color (Double Side)',
        'finish': 'Finish',
        'shape': 'Shape',
        'material': 'Material',
    };
    
    /**
     * Manually defines the preferred display order for variant keys.
     * Keys not listed here will be added at the end in their natural order.
     */
    const DISPLAY_ORDER = [
        'Size', 
        'Material', 
        'Type/Finish', 
        'Finish', 
        'Print Color (Single Side)', 
        'Print Color (Double Side)',
        'Material/Stock',
        'Shape',
        'Accessories',
        'Inking Mechanism'
    ];

    function sortAttributeKeys(keys) {
        return keys.sort((a, b) => {
            const indexA = DISPLAY_ORDER.indexOf(a);
            const indexB = DISPLAY_ORDER.indexOf(b);

            // If both are in the defined order, sort by their index.
            if (indexA !== -1 && indexB !== -1) {
                return indexA - indexB;
            }
            // If only A is defined, A comes first.
            if (indexA !== -1) {
                return -1;
            }
            // If only B is defined, B comes first.
            if (indexB !== -1) {
                return 1;
            }
            // If neither is defined, sort alphabetically (or by original key order).
            return a.localeCompare(b); 
        });
    }
    
    // NEW Helper function for Design Fee Calculation
    function calculateDesignFee(itemAreaSqft, quantity) {
        let baseFee = 0;
        
        // 1. Calculate Base Fee (based on ITEM area)
        for (const tier of DESIGN_FEE_TIERS) {
            if (itemAreaSqft >= tier.min_sqft && itemAreaSqft <= tier.max_sqft) {
                baseFee = tier.base_fee;
                break;
            }
        }
        
        // 2. Calculate Quantity Multiplier (50 PKR for every 5 extra pieces over Qty 1)
        let qtyFee = 0;
        if (quantity > 1) {
            // Pieces beyond the first one
            const additionalPieces = quantity - 1; 
            // Count how many groups of 5 pieces are fully or partially covered by the additional pieces
            const additionsCount = Math.floor((additionalPieces + DESIGN_FEE_QTY_THRESHOLD - 1) / DESIGN_FEE_QTY_THRESHOLD);
            qtyFee = additionsCount * DESIGN_FEE_QTY_INCREMENT;
        }

        return baseFee + qtyFee;
    }

    // NEW Helper function for Profit Multiplier
    function getAreaProfitMultiplier(quantity) {
        let multiplier = 1.10; // Default to the lowest profit
        
        for (const tier of AREA_PROFIT_TIERS) {
            if (quantity >= tier.min_qty && quantity <= tier.max_qty) {
                multiplier = tier.multiplier;
                break;
            }
        }
        return multiplier;
    }


    // --- Core Functions ---

    async function initialAppLoad() {
        let rawData;
        try {
            const response = await fetch(PUBLIC_DATA_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            rawData = await response.json(); 
        } catch (error) {
            console.error("Failed to load shop data:", error);
            showAlert("Failed to load product data. Check the developer console.", 'error');
            return;
        }
        
        initialProductSetup(rawData);
        
        showSection('shop-catalog'); 
        
        document.getElementById('quote-form').addEventListener('submit', handleQuoteSubmission);
        document.getElementById('contact-form-whatsapp').addEventListener('submit', handleContactSubmission);
        
        if (typeof setActiveMobileNav === 'function') {
            setActiveMobileNav('products');
        }
    }
    
    // --- Data Preprocessing for JSON Results ---
    function initialProductSetup(flatData) {
        const productGroups = {};
        
        Object.keys(flatData).forEach(categoryKey => {
            const categoryData = flatData[categoryKey];

            // 1. Handle Digital Printing Pricing (Tiered - Remapped to 'B/W and Color Prints')
            if (categoryKey === "B/W and Color Prints") {
                digitalPrintingPricing["Digital Print (Tiered)"] = categoryData;
                
                if (Object.keys(categoryData || {}).length > 0) {
                    productGroups["Digital Print (Tiered)"] = {
                         baseName: "Digital Print (Tiered)",
                         minPrice: 6, 
                         imageFile: `digital`, // Use a local image name
                         isAreaBased: false,
                         mainCategory: categoryKey,
                         isDigitalTiered: true, 
                         combinations: [] 
                    };
                }
                return;
            }
            
            // Skip Wedding card data here, as it's handled exclusively by wedding.html
            if (categoryKey === "Special Occasions (Wedding)") return;

            // 2. Handle standard products and merged categories
            Object.keys(categoryData).forEach(productKey => {
                 const productCombinations = categoryData[productKey];
                 
                 // Initialize product structure
                 if (!productGroups[productKey]) {
                     // Normalize product name to file name, matching the local file system (e.g., 'Shine Visisting Cards' -> 'vcard')
                     let imageFileBase = productKey.replace(/\s|\/|\(|\)/g, '').replace('Visisting', 'vcard').toLowerCase();
                     if (imageFileBase === 'ishtihar') imageFileBase = 'pamphlet';
                     if (imageFileBase === 'tshirtcotton' || imageFileBase === 'tshirtmulticolor') imageFileBase = 'cottonshirt';
                     if (productKey === 'File Covers') imageFileBase = 'file';
                     
                     // Check if product is Area Based
                     const isAreaBased = AREA_BASED_PRODUCT_NAMES.includes(productKey);
                     
                     productGroups[productKey] = {
                         baseName: productKey,
                         minPrice: Infinity,
                         imageFile: imageFileBase, // Uses the cleaned local image file name
                         isAreaBased: isAreaBased,
                         mainCategory: categoryKey,
                         combinations: [] 
                     };
                 }
                 
                 // Populate combinations for standard products 
                 if (!productGroups[productKey].isAreaBased && Array.isArray(productCombinations)) {
                     
                     productCombinations.forEach(item => {
                         let attributes = {
                             'Price': parseFloat(item.price) || 0,
                             'FullName': productKey 
                         };
                         
                         // Map and include all relevant keys from JSON object
                         Object.keys(item).forEach(key => {
                             if (key !== 'price' && key !== 'imageFile' && item[key]) {
                                 const displayKey = variantDisplayNames[key] || key.charAt(0).toUpperCase() + key.slice(1);
                                 if (key !== 'variant_3' && displayKey === attributes.FullName) return; 
                                 attributes[displayKey] = item[key];
                             }
                         });
                         
                         productGroups[productKey].combinations.push(attributes);

                         if (attributes.Price > 0 && attributes.Price < productGroups[productKey].minPrice) {
                             productGroups[productKey].minPrice = attributes.Price;
                         }
                     });
                 }
            });
        });
        
        allProductGroups = productGroups;
    }


    // New function for Digital Printing Details (Tiered Pricing)
    function showDigitalPrintingDetails() {
         currentProduct = allProductGroups["Digital Print (Tiered)"];
         currentSelectedVariations = {}; 
         
         if (!currentProduct || !digitalPrintingPricing["Digital Print (Tiered)"]) {
             showAlert(`Digital Print calculator data not found.`, 'error');
             return;
         }

         document.getElementById('detail-product-name-header').textContent = currentProduct.baseName;
         document.getElementById('detail-product-name-body').textContent = currentProduct.baseName;
         
         document.getElementById('detail-product-image-webp').srcset = `img/products/${currentProduct.imageFile}.webp`;
         document.getElementById('detail-product-image').src = `img/products/${currentProduct.imageFile}.png`; 
         document.getElementById('detail-product-image').onerror = function() { this.src = `img/products/placeholder.png`; };

         const areaInputs = document.getElementById('custom-area-inputs');
         const standardOptions = document.getElementById('standard-options-fields');
         
         areaInputs.style.display = 'none';
         standardOptions.style.display = 'block';
         standardOptions.innerHTML = '';
         
         document.getElementById('finalPriceBox').style.display = 'none';
         document.getElementById('selectionWarning').textContent = "Please select all printing options and enter quantity to see the final price.";
         document.getElementById('selectionWarning').classList.remove('alert-danger');
         document.getElementById('selectionWarning').classList.add('alert-info');
         document.getElementById('selectionWarning').style.display = 'block';

         const sizes = Object.keys(digitalPrintingPricing["Digital Print (Tiered)"]);
         
         if(sizes.length === 0) {
             standardOptions.innerHTML = `<p class="alert alert-warning">Digital Printing tiers not loaded. Please contact support.</p>`;
             showSection('product-detail');
             return;
         }
         
         let html = '';
         const keysToRender = ['Size', 'ColorType', 'GSM']; 
         const sizesList = Object.keys(digitalPrintingPricing["Digital Print (Tiered)"]); 
         
         keysToRender.forEach(key => {
            html += `<div class="product-option-group" data-option-key="${key}">
                    <label>${key.replace('ColorType', 'Print Color').replace('GSM', 'Paper Weight (GSM)')}:</label>
                    <div class="d-flex flex-wrap gap-3" id="choices-${key}">`;
            
            let currentOptions = [];
            if (key === 'Size') {
                currentOptions = sizesList;
            } else if (key === 'ColorType' && sizesList.length > 0) {
                currentOptions = Object.keys(digitalPrintingPricing["Digital Print (Tiered)"][sizesList[0]] || {});
            } else if (key === 'GSM' && sizesList.length > 0) {
                const firstColorType = Object.keys(digitalPrintingPricing["Digital Print (Tiered)"][sizesList[0]] || {})[0];
                 if (firstColorType) {
                    currentOptions = Object.keys(digitalPrintingPricing["Digital Print (Tiered)"][sizesList[0]][firstColorType] || {});
                 }
            }

            currentOptions.forEach(value => {
                 const displayValue = value.replace('_', ' ').toUpperCase();
                 const inputId = `${key}-${value}`;
                 html += `<label class="choice-card" for="${inputId}">
                             <input type="radio" id="${inputId}" name="option-${key}" value="${value}" 
                                    onchange="handleCardSelection('${key}', '${value}', true)">
                             <span class="label-text">${displayValue}</span>
                         </label>`;
            });
            html += `</div></div>`;
         });

         standardOptions.innerHTML += html;
         
         // Add quantity selector for pages
         standardOptions.innerHTML += `
              <div class="product-option-group" data-option-key="QuantitySelector">
                 <label>Number of Pages:</label>
                 <div class="input-group">
                     <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityStandard(-1)">-</button>
                     <input type="number" id="input-standard-qty" min="1" value="1" class="form-control text-center rounded-0" oninput="updateFinalPrice()">
                     <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityStandard(1)">+</button>
                 </div>
             </div>
         `;
         
         // Auto-select first options for Digital Printing and trigger initial price
         keysToRender.forEach(key => {
            const firstInput = document.querySelector(`input[name="option-${key}"]`);
            if (firstInput) {
                firstInput.checked = true; // Set initial radio button checked
                handleCardSelection(key, firstInput.value, false); 
            }
         });
         
         updateFinalPrice();

         showSection('product-detail');
    }

    /**
     * Finds all valid values for a specific target key based on currently selected upstream keys.
     */
    function filterAvailableOptions(targetKey, currentSelections, allCombinations) {
        const validValues = new Set();
        
        allCombinations.forEach(combo => {
            let isMatch = true;
            
            const keysToCheck = Object.keys(currentSelections).filter(k => k !== targetKey);
            
            for (const key of keysToCheck) {
                 if (combo[key] !== currentSelections[key]) {
                    isMatch = false;
                    break;
                 }
            }
            
            if (isMatch && combo[targetKey]) {
                validValues.add(combo[targetKey]);
            }
        });
        
        return validValues;
    }

    // 4. Navigate to and Populate Product Detail Page
    function showProductDetails(productName) {
        
        if (productName.trim() === "Digital Print (Tiered)") {
             showDigitalPrintingDetails();
             return;
        }
        // Handle "PhotoPapers" redirecting to the proper key "Photo Printing"
        if (productName.trim() === "PhotoPapers") {
             productName = "Photo Printing";
        }


        let cleanName = productName.replace(/'/g, '').trim(); 
        const productData = allProductGroups[cleanName]; 
        currentProduct = productData;
        currentSelectedVariations = {}; 

        if (!currentProduct) {
            showAlert(`Product "${cleanName}" details not found in data. Please use the 'Get Custom Quote' option.`, 'error'); 
            return;
        }

        // Update headers and image
        document.getElementById('detail-product-name-header').textContent = currentProduct.baseName;
        document.getElementById('detail-product-name-body').textContent = currentProduct.baseName;
        
        const imagePath = currentProduct.imageFile;
        document.getElementById('detail-product-image-webp').srcset = `img/products/${imagePath}.webp`;
        document.getElementById('detail-product-image').src = `img/products/${imagePath}.png`; 
        document.getElementById('detail-product-image').onerror = function() { 
             this.src = `img/products/placeholder.png`; 
        };


        const areaInputs = document.getElementById('custom-area-inputs');
        const standardOptions = document.getElementById('standard-options-fields');
        
        document.getElementById('finalPriceBox').style.display = 'none';
        document.getElementById('selectionWarning').textContent = "Please enter dimensions/quantity or select all options above to see the final price.";
        document.getElementById('selectionWarning').classList.remove('alert-danger');
        document.getElementById('selectionWarning').classList.add('alert-info');
        document.getElementById('selectionWarning').style.display = 'block';

        const isAreaBased = currentProduct.isAreaBased;
        
        // 🛑 CORE LOGIC: Area-Based vs. Standard 🛑
        if (isAreaBased) {
            // --- AREA-BASED SETUP (Panaflex/Wallpaper/Photo Frames) ---
            areaInputs.style.display = 'block';
            
            // Inject Design Service option group before existing standard options
            standardOptions.style.display = 'block'; 
            standardOptions.innerHTML = `
                <div class="product-option-group" data-option-key="DesignService">
                    <label>Design Service:</label>
                    <div class="d-flex flex-wrap gap-3">
                        <label class="choice-card selected" id="design-printready" 
                               onclick="currentSelectedVariations['DesignService']='PrintReady'; updateFinalPrice()">
                            <input type="radio" name="option-DesignService" value="PrintReady" checked>
                            <span class="label-text">Print Ready File</span>
                        </label>
                        <label class="choice-card" id="design-needed" 
                               onclick="currentSelectedVariations['DesignService']='DesignNeeded'; updateFinalPrice()">
                            <input type="radio" name="option-DesignService" value="DesignNeeded">
                            <span class="label-text">Design Service Required</span>
                        </label>
                    </div>
                </div>`;
            
            // Set initial selection state for the new option
            currentSelectedVariations['DesignService'] = 'PrintReady';

            // Reset Dimension inputs
            document.getElementById('input-width').value = 1;
            document.getElementById('input-height').value = 1;
            document.getElementById('input-custom-qty').value = 1;

            ['input-width', 'input-height', 'input-custom-qty'].forEach(id => {
                 const el = document.getElementById(id);
                 if(el) el.oninput = updateFinalPrice;
            });
            
            document.getElementById('areaConstraintWarning').style.display = 'none';
            document.getElementById('areaConstraintWarning').classList.remove('alert-info');
            document.getElementById('areaConstraintWarning').classList.add('alert-danger'); // Default style is error, use info for fee

            updateFinalPrice();

        } else {
            // --- STANDARD TIERED ITEM SETUP ---
            areaInputs.style.display = 'none';
            standardOptions.style.display = 'block';
            standardOptions.innerHTML = ''; 

            const allCombinations = currentProduct.combinations || [];
            if (allCombinations.length === 0 || !allCombinations[0]) {
                 standardOptions.innerHTML = `<p class="alert alert-warning">No price configurations found for this product. Please use the Quote form.</p>`;
                 return;
            }

            let attributeKeys = Object.keys(allCombinations[0]).filter(key => key !== 'Price' && key !== 'FullName');
            
            // FIX: Sort attribute keys using the defined priority
            attributeKeys = sortAttributeKeys(attributeKeys);


            const availableAttributes = {};
            attributeKeys.forEach(key => availableAttributes[key] = new Set());

            allCombinations.forEach(c => {
                attributeKeys.forEach(key => {
                    if (c[key]) availableAttributes[key].add(c[key]);
                });
            });
            
            // Render groups of unique values for each attribute
            attributeKeys.forEach((attrKey) => {
                const uniqueValues = Array.from(availableAttributes[attrKey]);
                const sanitizedKey = attrKey;

                let groupHTML = `
                    <div class="product-option-group" data-option-key="${sanitizedKey}">
                        <label>${attrKey}:</label>
                        <div class="d-flex flex-wrap gap-3" id="choices-${sanitizedKey}">
                `;
                
                // Sort values for cleaner UI
                uniqueValues.sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' }));

                uniqueValues.forEach(value => {
                    const inputId = `${sanitizedKey}-${value.replace(/\s|\/|\\|\(|\)/g, '-')}`;
                    
                    groupHTML += `
                        <label class="choice-card" for="${inputId}">
                            <input type="radio" id="${inputId}" name="option-${sanitizedKey}" value="${value}" 
                                   onchange="handleCardSelection('${sanitizedKey}', '${value}')">
                            <span class="label-text">${value}</span>
                        </label>
                    `;
                });

                groupHTML += `</div></div>`;
                standardOptions.innerHTML += groupHTML;
            });

            // Add quantity selector for standard items
            standardOptions.innerHTML += `
                 <div class="product-option-group" data-option-key="QuantitySelector">
                    <label>Quantity:</label>
                    <div class="input-group">
                        <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityStandard(-1)">-</button>
                        <input type="number" id="input-standard-qty" min="1" value="1" class="form-control text-center rounded-0" oninput="updateFinalPrice()">
                        <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityStandard(1)">+</button>
                    </div>
                </div>
            `;
            
            document.getElementById('finalPriceBox').style.display = 'none';
            document.getElementById('selectionWarning').style.display = 'block';

            // Initial auto-selection to set defaults and trigger cascading update
            if (attributeKeys.length > 0) {
                 const firstKey = attributeKeys[0];
                 const firstValue = Array.from(availableAttributes[firstKey])[0];
                 if(firstValue) {
                    const firstInput = document.querySelector(`input[name="option-${firstKey}"][value="${firstValue}"]`);
                    if(firstInput) firstInput.checked = true;
                    handleCardSelection(firstKey, firstValue);
                 }
            } else {
                updateFinalPrice();
            }
        }

        showSection('product-detail');
    }
    
    // Helper for quantity buttons on standard items
    function updateQuantityStandard(change) {
        const input = document.getElementById('input-standard-qty');
        let quantity = parseInt(input.value) || 1;
        quantity = Math.max(1, quantity + change);
        input.value = quantity;
        updateFinalPrice();
    }
    
    /**
     * Handles selection of a variant option, updates selections, and triggers cascading filtering.
     */
    function handleCardSelection(key, value, cascade = true) {
        const sanitizedKey = key;
        
        currentSelectedVariations[sanitizedKey] = value;
        
        // --- 1. Visual Selection Update ---
        document.querySelectorAll(`input[name="option-${sanitizedKey}"]`).forEach(input => {
            input.closest('.choice-card')?.classList.remove('selected');
        });
        const selectedInput = document.querySelector(`input[name="option-${sanitizedKey}"][value="${value}"]`);
        if (selectedInput) {
            selectedInput.closest('.choice-card')?.classList.add('selected');
        }

        if (currentProduct.isDigitalTiered) {
             if (cascade) updateFinalPrice();
             return;
        }

        // --- 2. Cascading Filter and Auto-Select for downstream variants (Standard Products Only) ---
        if (cascade) {
            let allAttributeKeys = Object.keys(currentProduct.combinations[0]).filter(k => k !== 'Price' && k !== 'FullName');
            
            // Re-sort the keys before starting the cascade process
            allAttributeKeys = sortAttributeKeys(allAttributeKeys);

            let startCascade = false;

            for (const attrKey of allAttributeKeys) {
                if (attrKey === key) {
                    startCascade = true;
                    continue; // Skip the currently selected key
                }
                
                if (startCascade) {
                    const targetGroup = document.getElementById(`choices-${attrKey}`);
                    if (targetGroup) {
                        const validValues = filterAvailableOptions(
                            attrKey, 
                            currentSelectedVariations, 
                            currentProduct.combinations
                        );
                        
                        let newSelectionNeeded = false;
                        
                        targetGroup.querySelectorAll('.choice-card').forEach(card => {
                            const inputEl = card.querySelector('input');
                            const optionValue = inputEl.value;
                            
                            if (!validValues.has(optionValue)) {
                                card.classList.add('disabled');
                                card.classList.remove('selected');
                                
                                if (currentSelectedVariations[attrKey] === optionValue) {
                                    delete currentSelectedVariations[attrKey];
                                    newSelectionNeeded = true;
                                }
                                
                            } else {
                                card.classList.remove('disabled');
                                
                                // Re-select the option if it was previously selected (and is still valid)
                                if (currentSelectedVariations[attrKey] === optionValue) {
                                     card.classList.add('selected');
                                     inputEl.checked = true;
                                }
                            }
                        });
                        
                        if (newSelectionNeeded || !currentSelectedVariations[attrKey]) {
                            const firstValidOption = targetGroup.querySelector('.choice-card:not(.disabled) input');
                            if (firstValidOption) {
                                firstValidOption.checked = true; // Select the first valid radio button
                                handleCardSelection(attrKey, firstValidOption.value);
                                return; 
                            } else {
                                delete currentSelectedVariations[attrKey];
                            }
                        }
                    }
                }
            }
        }
        
        // --- 3. Final Price Update & Image Update ---
        updateFinalPrice();
    }
    
    // --- Price Update and Calculation Logic (Handles all three types) ---
    
    function updateFinalPrice() {
        if (!currentProduct) return;
        
        const isAreaBased = currentProduct.isAreaBased;
        const isDigitalTiered = currentProduct.isDigitalTiered;
        let totalPrice = 0;

        // 1. Handle Area-Based Products (Panaflex, Photo Frames)
        if (isAreaBased) {
            const width = parseFloat(document.getElementById('input-width').value) || 0;
            const height = parseFloat(document.getElementById('input-height').value) || 0;
            const quantity = parseInt(document.getElementById('input-custom-qty').value) || 0;

            const rateMeta = AREA_BASED_META[currentProduct.baseName];
            const baseRate = rateMeta ? rateMeta.rate : 0;
            const minArea = rateMeta ? rateMeta.min_area || 0 : 0;
            const designService = currentSelectedVariations['DesignService'] || 'PrintReady';

            
            document.getElementById('finalPriceBox').style.display = 'none';
            document.getElementById('areaConstraintWarning').style.display = 'none';
            document.getElementById('selectionWarning').style.display = 'block';
            document.getElementById('selectionWarning').textContent = "Please enter valid dimensions and quantity to calculate price.";
            
            if (width <= 0 || height <= 0 || quantity <= 0 || baseRate === 0) {
                document.getElementById('areaDisplay').textContent = '';
                return;
            }

            const itemArea = width * height;
            const totalArea = itemArea * quantity;
            document.getElementById('areaDisplay').textContent = `Area per piece: ${itemArea.toFixed(2)} sq ft | Total Area: ${totalArea.toFixed(2)} sq ft;

            if (totalArea < minArea) {
                document.getElementById('areaConstraintWarning').textContent = `Minimum order area for this product is ${minArea} sq ft. Current total area (${totalArea.toFixed(2)} sq ft) is too small.`;
                document.getElementById('areaConstraintWarning').style.display = 'block';
                return; 
            }
            
            // 1. Calculate Base Print Cost
            const basePrintCost = totalArea * baseRate;

            // 2. Calculate Dynamic Design Fee (if required)
            let totalDesignFee = 0;
            if (designService === 'DesignNeeded') {
                totalDesignFee = calculateDesignFee(itemArea, quantity);
                
                // Show Design Fee in the warning box (now used for fee display)
                document.getElementById('areaConstraintWarning').classList.remove('alert-danger');
                document.getElementById('areaConstraintWarning').classList.add('alert-info');
                document.getElementById('areaConstraintWarning').innerHTML = `<i class="fas fa-magic me-2"></i> **Design Fee Applied**: PKR ${totalDesignFee.toLocaleString('en-PK', { minimumFractionDigits: 0 })}`;
                document.getElementById('areaConstraintWarning').style.display = 'block';

            } else {
                 document.getElementById('areaConstraintWarning').style.display = 'none';
            }
            
            // 3. Calculate Total Cost (Cost before Profit Markup)
            const totalCostBeforeProfit = basePrintCost + totalDesignFee;

            // 4. Determine Profit Multiplier
            const profitMultiplier = getAreaProfitMultiplier(quantity);
            
            // 5. Final Price Calculation
            totalPrice = Math.round(totalCostBeforeProfit * profitMultiplier);

        } 
        
        // 2. Handle Digital Printing Tiered Products 
        else if (isDigitalTiered) {
             const quantity = parseInt(document.getElementById('input-standard-qty')?.value) || 0;
             const size = currentSelectedVariations.Size;
             const colorType = currentSelectedVariations.ColorType;
             const gsm = currentSelectedVariations.GSM;
             
             document.getElementById('finalPriceBox').style.display = 'none';
             document.getElementById('selectionWarning').style.display = 'block';
             document.getElementById('selectionWarning').textContent = "Please select all printing options and enter a valid quantity.";
             
             if (!size || !colorType || !gsm || quantity <= 0) return;
             
             try {
                const tiers = digitalPrintingPricing[currentProduct.baseName];
                const gsmData = tiers[size][colorType][gsm];
                
                if (!gsmData) throw new Error("Price data missing for selected options.");
                
                let unitPrice = 0;
                let foundPrice = false;
                
                // Find the correct quantity tier
                Object.keys(gsmData).forEach(rangeKey => {
                    const [min, max] = rangeKey.split('-').map(n => parseInt(n));
                    if (quantity >= min && (isNaN(max) || quantity <= max)) { 
                        unitPrice = gsmData[rangeKey];
                        foundPrice = true;
                    }
                });
                
                if (foundPrice) {
                    totalPrice = unitPrice * quantity;
                    document.getElementById('selectionWarning').textContent = `Price is based on ${unitPrice.toFixed(2)} PKR per page.`;
                } else {
                    document.getElementById('selectionWarning').textContent = "Price tier not found for this quantity. Contact for custom quote.";
                    return;
                }

             } catch(e) {
                 console.error("Digital Printing Price Calculation Error:", e);
                 document.getElementById('selectionWarning').textContent = "Error calculating price. Select options again or contact us.";
                 return;
             }
        }

        // 3. Standard Tiered Products (Business Cards, Letterpads, etc.) 
        else {
            const quantity = parseInt(document.getElementById('input-standard-qty')?.value) || 1;
            const allCombinations = currentProduct?.combinations || [];
            
            if (allCombinations.length === 0) return;

            const requiredKeys = Object.keys(allCombinations[0]).filter(key => key !== 'Price' && key !== 'FullName');
            
            let selectedAttributes = {};
            let allSelected = true;

            requiredKeys.forEach(key => {
                if (!currentSelectedVariations[key]) {
                    allSelected = false;
                } else {
                    selectedAttributes[key] = currentSelectedVariations[key];
                }
            });

            if (!allSelected) {
                document.getElementById('finalPriceBox').style.display = 'none';
                document.getElementById('selectionWarning').textContent = "Please select all required options.";
                document.getElementById('selectionWarning').style.display = 'block';
                return;
            }

            let finalProductCombination = null;
            allCombinations.forEach(combo => {
                let matches = true;
                requiredKeys.forEach(key => {
                    if (combo[key] !== selectedAttributes[key]) {
                        matches = false;
                    }
                });
                if (matches) {
                    finalProductCombination = combo;
                }
            });
            
            if (finalProductCombination) {
                const unitPrice = finalProductCombination.Price;
                totalPrice = unitPrice * quantity;
                document.getElementById('selectionWarning').textContent = `Price is based on ${unitPrice.toFixed(2)} PKR per unit.`;
            } else {
                document.getElementById('selectionWarning').textContent = "Selected combination not available. Try another mix.";
                document.getElementById('selectionWarning').classList.remove('alert-info');
                document.getElementById('selectionWarning').classList.add('alert-danger');
                document.getElementById('finalPriceBox').style.display = 'none';
                document.getElementById('selectionWarning').style.display = 'block';
                return;
            }
            
            // Image update logic 
            let newImagePath = currentProduct.imageFile;
            let variantSuffix = '';

            if (currentSelectedVariations['Type/Finish']) {
                 variantSuffix = currentSelectedVariations['Type/Finish'].replace(/\s|\/|\\|\(|\)/g, '').toLowerCase();
            } 
            else if (currentSelectedVariations['Size'] && requiredKeys[0] === 'Size') {
                variantSuffix = currentSelectedVariations['Size'].replace(/\s|\/|\\|\(|\)/g, '').toLowerCase();
            }

            if (variantSuffix) {
                const newImageBase = newImagePath + variantSuffix;
                const newWebp = `img/products/${newImageBase}.webp`;
                const newPng = `img/products/${newImageBase}.png`;

                document.getElementById('detail-product-image-webp').srcset = newWebp;
                document.getElementById('detail-product-image').src = newPng;
                
                const baseImageFile = currentProduct.imageFile;
                document.getElementById('detail-product-image').onerror = function() {
                    this.onerror = null; 
                    this.src = `img/products/${baseImageFile}.png`; 
                    document.getElementById('detail-product-image-webp').srcset = `img/products/${baseImageFile}.webp`;
                };

            } else {
                 const baseImageFile = currentProduct.imageFile;
                 document.getElementById('detail-product-image-webp').srcset = `img/products/${baseImageFile}.webp`;
                 document.getElementById('detail-product-image').src = `img/products/${baseImageFile}.png`;
                 document.getElementById('detail-product-image').onerror = function() { this.src = `img/products/placeholder.png`; };
            }
        }
        
        // --- Final Display ---
        document.getElementById('finalPriceDisplay').textContent = `PKR ${totalPrice.toLocaleString('en-PK', { minimumFractionDigits: 0 })}`;
        document.getElementById('finalPriceBox').style.display = 'block';
        document.getElementById('selectionWarning').style.display = 'none';
    }


    // 3. Get A Quote Submission Handler (Keeps WhatsApp)
    function handleQuoteSubmission(e) {
        e.preventDefault();
        
        const name = document.getElementById('quote-name').value;
        const phone = document.getElementById('quote-phone').value;
        const product = document.getElementById('quote-product').value;
        const quantity = document.getElementById('quote-quantity').value;
        const details = document.getElementById('quote-details').value;
        
        let whatsappMessage = `*NEW QUOTE REQUEST (WEB - PRODUCTS)*\n`;
        whatsappMessage += `*Customer:* ${name}\n`;
        whatsappMessage += `*Phone (Contact):* ${phone}\n`;
        whatsappMessage += `*Product Type:* ${product}\n`;
        whatsappMessage += `*Quantity/Area:* ${quantity}\n`;
        whatsappMessage += `*Specifications:* ${details}`;
        
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');

        showAlert('Quote submitted via WhatsApp! We will contact you shortly.', 'success');
        document.getElementById('quote-form').reset();
    }


    // 2. Contact Form Submission Handler (Keeps WhatsApp)
    function handleContactSubmission(e) {
        e.preventDefault();
        
        const name = document.getElementById('contact-name').value;
        const subject = document.getElementById('contact-subject').value;
        const message = document.getElementById('contact-message').value;

        let whatsappMessage = `*NEW CONTACT MESSAGE (WEB - PRODUCTS)*\n`;
        whatsappMessage += `*Sender:* ${name}\n`;
        whatsappMessage += `*Subject:* ${subject}\n`;
        whatsappMessage += `*Message:* ${message}`;
        
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');

        showAlert('Message sent via WhatsApp!', 'success');
        document.getElementById('contact-form-whatsapp').reset();
    }
    
    // Placeholder submitOrder function
    async function submitOrder(type) {
          // You would normally validate selections here, but the price calculation already handles that.
          if (document.getElementById('finalPriceBox').style.display === 'none') {
             showAlert('Please select all options and enter a valid quantity/area before placing an order.', 'error');
             return;
          }

          showAlert(`Order submission initiated for ${currentProduct.baseName}. Redirecting to quote...`, 'info');
          
          // Redirect to quote for final confirmation/details
          showSection('quote');
          document.getElementById('quote-product').value = `${currentProduct.baseName} - Final Price: ${document.getElementById('finalPriceDisplay').textContent}`;
          document.getElementById('quote-quantity').value = document.getElementById('input-standard-qty')?.value || document.getElementById('input-custom-qty')?.value || 1;
          
          let detailsMsg = "Please confirm the order details.";
          
          if (currentProduct?.isAreaBased) {
              const width = document.getElementById('input-width').value;
              const height = document.getElementById('input-height').value;
              const qty = document.getElementById('input-custom-qty').value;
              const design = currentSelectedVariations['DesignService'];
              
              detailsMsg = `Area-Based Order Details:\nDimensions: ${width}x${height} ft\nQuantity: ${qty} pcs\nDesign Service: ${design}`;

              const designFeeDisplay = document.getElementById('areaConstraintWarning').textContent;
              if (designFeeDisplay && design !== 'PrintReady') {
                  detailsMsg += `\n${designFeeDisplay}`;
              }

          } else if (currentProduct && currentSelectedVariations) {
              detailsMsg = "Selected options:\n" + Object.entries(currentSelectedVariations).map(([k, v]) => `${k}: ${v}`).join('\n');
          }
          
          document.getElementById('quote-details').value = detailsMsg;
    }


    // --- UI/Navigation Functions ---
    function showSection(sectionName) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        const sectionElement = document.getElementById(sectionName + '-section');
        if (sectionElement) {
            sectionElement.classList.add('active');
        } else {
             document.getElementById('shop-catalog-section').classList.add('active');
        }
        
        document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        const desktopLink = document.querySelector(`.navbar-nav a[onclick="showSection('${sectionName}')"]`);
        if (desktopLink) desktopLink.classList.add('active');
        
        if (typeof setActiveMobileNav === 'function') {
            setActiveMobileNav(sectionName === 'shop-catalog' ? 'products' : sectionName);
        }
        
        window.scrollTo(0, 0);
    }
    
    function showAlert(message, type) {
        const alert = document.createElement('div');
        alert.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        alert.style.top = '20px';
        alert.style.right = '20px';
        alert.style.zIndex = '9999';
        alert.style.minWidth = '300px';
        alert.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(alert);
        
        setTimeout(() => {
            if (alert.parentNode) {
                alert.parentNode.removeChild(alert);
            }
        }, 5000);
    }

    document.addEventListener('DOMContentLoaded', initialAppLoad);
</script>
</div>
</body>

</html>


