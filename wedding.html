<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Arham Printers - Custom Wedding Invitation Cards</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Custom Wedding Cards, Wedding Invitation Design, Printing Services" name="keywords">
    <meta content="Explore the full range of custom wedding card designs with bulk pricing from Arham Printers." name="description">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <style>
        /* General Layout and Utility Styles */
        :root {
            --bs-primary: #f28b00; /* Assuming this is your primary color */
            --bs-secondary: #ff5722; /* Example secondary color */
            --bs-dark: #212529;
            --mobile-nav-height: 60px;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .final-price-box {
            background: var(--bs-primary);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            text-align: center;
            display: none; 
        }
        .final-price-box h4 {
            color: white;
        }
        
        /* ---------------------------------------------------- */
        /* RESPONSIVE HEADER IMAGE IMPLEMENTATION (NEW LOGIC) */
        /* ---------------------------------------------------- */
        .page-header {
            /* Default: Use Mobile Image (Mobile First Approach) */
            background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url(img/banners/weddingmobile.webp) center center no-repeat;
            background-size: cover;
            min-height: 250px;
        }

        @media (min-width: 768px) {
            .page-header {
                /* Override: Use Desktop Image on larger screens */
                background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url(img/banners/weddingdesktop.webp) center center no-repeat;
                background-size: cover;
                min-height: 350px;
            }
        }
        /* ---------------------------------------------------- */
        
        /* --- DESKTOP NAV FIX --- */
        /* Remove margin from h1 inside the desktop navbar brand for alignment */
        .navbar-brand h1 {
            margin-top: 0;
            margin-bottom: 0;
        }

        /* Clickable Card Variations (Standard Items) */
        .choice-card {
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            text-align: center;
            transition: all 0.2s ease;
            flex-grow: 1;
            min-width: 120px;
            opacity: 1; /* Default to visible */
        }
        .choice-card:hover {
            border-color: var(--bs-secondary);
            background-color: #fff8f8;
        }
        .choice-card.selected {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary);
            color: white;
            box-shadow: 0 0 10px rgba(242, 139, 0, 0.3);
        }
        /* Style for visually disabling non-selectable options */
        .choice-card.disabled {
            opacity: 0.5;
            pointer-events: none; /* Disable interaction */
            border-color: #eee;
            background-color: #f7f7f7;
        }
        .choice-card input[type="radio"] {
            display: none;
        }
        .choice-card .label-text {
            font-weight: 500;
            color: var(--bs-dark);
            display: block;
        }
        .choice-card.selected .label-text {
            color: white;
        }
        .product-option-group {
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .product-option-group label {
            font-weight: 600;
            color: var(--bs-dark);
            margin-bottom: 0.75rem;
            display: block;
            font-size: 1.1rem;
        }

        /* --- MOBILE BOTTOM NAVIGATION STYLES --- */

        /* 1. Mobile Bottom Bar Container */
        #mobile-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--mobile-nav-height);
            background: white;
            border-top: 1px solid #ddd;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1030;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        
        /* **FIX 1: Ensure all 5 top-level elements take equal width** */
        #mobile-bottom-nav > a, 
        #mobile-bottom-nav > div {
            flex: 1 1 0%; /* Equal distribution: 20% width per slot */
        }

        /* 2. Mobile Link Styling */
        .mobile-nav-link {
            flex: 1; 
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            text-decoration: none;
            color: var(--bs-dark);
            font-size: 0.6rem; /* Smaller text for compact look */
            padding: 5px 0;
            transition: color 0.2s;
            position: relative;
            height: 100%;
            justify-content: center;
        }
        .mobile-nav-link:hover {
             color: var(--bs-primary);
        }
        .mobile-nav-link i {
            font-size: 1.1rem;
            margin-bottom: 2px;
            line-height: 1;
        }
        .mobile-nav-link.active {
            color: var(--bs-primary);
        }
        

/* Update the existing #mobile-nav-logo section */
/* 3. Center Logo Button */
#mobile-nav-logo {
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* Make it relative for absolute children */
}
#mobile-nav-logo a {
            background-color: var(--bs-primary);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(242, 139, 0, 0.6);
            position: absolute; 
            top: -15px; 
            /* **FIX 2: Center absolutely positioned element within its slot** */
            left: 50%;
            transform: translateX(-50%); 
}

/* NEW RULE: Style the image inside the centered mobile button */
#mobile-nav-logo a img {
    /* Ensures the image is centered and prevents vertical alignment issues */
    vertical-align: middle; 
    /* Ensures the image doesn't overflow the 45px circle container */
    max-width: 80%; 
    max-height: 80%;
    height: auto !important; /* Overrides inline height if needed, maintaining aspect ratio */
}

#mobile-nav-logo a i {
            font-size: 1.5rem;
}
        /* 4. Content Padding to clear the fixed bottom nav */
        #shop-catalog-section, #product-detail-section, #quote-section, #contact-section {
            padding-bottom: calc(var(--mobile-nav-height) + 15px); /* Add space for the bottom navbar */
        }
        
        /* 5. Compact Category Link Styling (Removed, but keeping class definitions minimal) */
        .categories-item a {
            font-size: 0.75rem; 
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 0;
            line-height: 1.2;
        }
        .categories-item a i {
            font-size: 1.2rem; 
            margin-bottom: 5px !important;
        }
        
        /* 6. Mobile Dropdown Specific Styling */
        #mobile-bottom-nav .dropdown-menu {
            position: absolute;
            bottom: var(--mobile-nav-height); /* Position above the nav bar */
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            border-radius: 8px 8px 0 0;
            padding: 10px 0;
        }
        #mobile-bottom-nav .dropdown-item {
             font-size: 0.8rem;
        }
    </style>
</head>

<body>
    <div class="container">
    <div class="container-fluid bg-dark text-white-50 py-2 px-0 d-none d-lg-block">
        <div class="row gx-0 align-items-center">
            <div class="col-lg-7 px-5 text-start">
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="fa fa-phone-alt me-2"></small>
                    <small>+92 300 6238233</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-envelope-open me-2"></small>
                    <small>info@arhamprinters.pk</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="far fa-clock me-2"></small>
                    <small>Mon - Fri : 09 AM - 09 PM</small>
                </div>
            </div>
            <div class="col-lg-5 px-5 text-end">
                <div class="h-100 d-inline-flex align-items-center">
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-facebook-f"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-twitter"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-white-50 ms-4" href=""><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
    
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top px-4 px-lg-5 d-none d-lg-block">
    
    <div class="d-flex w-100 justify-content-between align-items-center">
        
        <a href="index.html" class="navbar-brand d-flex align-items-center me-4">
            <img src="img/logo2.webp" alt="Arham Printers Logo" style="height: 40px; margin-right: 1rem;">
            <span style="font-size: 0.75rem; color: #6c757d; margin-top: 15px;">Arham Printers</span>
        </a>

        <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse flex-grow-1" id="navbarCollapse">
            <div class="navbar-nav me-auto bg-light pe-4 py-3 py-lg-0 d-flex align-items-center">
                
                <a href="index.html" class="nav-item nav-link">Home</a>
                <a href="products.html" class="nav-item nav-link">Products</a>
                <a href="wedding.html" class="nav-item nav-link active">Wedding Cards</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Shop</a>
                    <div class="dropdown-menu bg-light border-0 m-0">
                        <a href="products.html" class="dropdown-item">All Products</a>
                        <a href="#quote-section" class="dropdown-item" onclick="showSection('quote')">Get Custom Quote</a>
                    </div>
                </div>
                <a href="#contact-section" class="nav-item nav-link" onclick="showSection('contact')">Contact</a>
            </div>
            
            <div class="h-100 d-lg-inline-flex align-items-center">
                <a class="btn-sm-square bg-white text-primary rounded-circle me-4 position-relative" href="#quote-section" onclick="showSection('quote')">
                    <i class="fas fa-file-invoice"></i>
                </a>
                <a href="#contact-section" class="btn btn-primary py-2 px-3 rounded-0 d-none d-lg-block" onclick="showSection('quote')">Get a Quote<i
                        class="fa fa-arrow-right ms-3"></i></a>
            </div>
        </div>
    </div>
</nav>

    <nav id="mobile-bottom-nav" class="d-lg-none">
    <a href="index.html" class="mobile-nav-link" id="mobile-link-home">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </a>
    
    <div class="nav-item dropup d-flex flex-fill justify-content-center">
         <a href="#" class="mobile-nav-link dropdown-toggle" data-bs-toggle="dropdown" id="mobile-link-categories">
             <i class="fas fa-th-large"></i>
             <span>Categories</span>
         </a>
        <div class="dropdown-menu bg-light border-0">
            <a href="products.html#business-essentials" class="dropdown-item">Business & Office Essentials</a>
             <a href="products.html#marketing-essentials" class="dropdown-item">Marketing & Promotional Items</a>
             <a href="products.html#digital-media" class="dropdown-item">Digital Media Marketing</a>
             <a href="products.html#printsing" class="dropdown-item">Custom & Large Format</a>
             <a href="print-order.html" class="dropdown-item">B/W and Color Prints</a>
             <a href="wedding.html" class="dropdown-item">Special Occasions (Wedding)</a>
        </div>
    </div>
    
    <div id="mobile-nav-logo">
         <a href="index.html" class="mobile-nav-link-center">
             <img src="img/logo.webp" alt="Logo" style="height: 80px;">
         </a>
    </div>
    
    <a href="products.html" class="mobile-nav-link" onclick="showSection('shop-catalog')" id="mobile-link-products">
        <i class="fas fa-th-list"></i>
        <span>Products</span>
    </a>
    
    <a href="wedding.html" class="mobile-nav-link active" id="mobile-link-wedding">
        <i class="fas fa-gift"></i>
        <span>Wedding Cards</span>
    </a>
</nav>
    
    <section id="shop-catalog-section" class="section active">
        <div class="container-fluid page-header py-5">
            <h2 class="text-center display-6">Wedding Card Collection</h2>
        </div>

        <div class="container py-5">
            <div class="row g-4 justify-content-center">
                <div class="col-lg-12">
                    <div class="row g-4" id="wedding-card-grid">
                        <div class="col-12 text-center" id="loading-spinner">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p>Loading Card Designs from Database...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="product-detail-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6" id="detail-product-name-header">Card Details</h1>
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a href="#" onclick="showSection('shop-catalog')">Catalog</a></li>
                <li class="breadcrumb-item active text-white">Details</li>
            </ol>
        </div>

        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-lg-6">
                        <div class="d-flex justify-content-center">
                            <img id="detail-product-image" src="img/products/placeholder.png" class="img-fluid rounded-0" alt="Product Image" style="max-height: 400px;">
                        </div>
                        <h4 class="mt-4" id="card-description">Elegant card suitable for all occasions. Custom text available.</h4>
                    </div>
                    
                    <div class="col-lg-6">
                        <h2 class="fw-bold mb-4" id="detail-product-name-body">Card Name</h2>
                        
                        <div id="standard-options-fields">
                            <div class="product-option-group" data-option-key="QuantitySelector">
                                <label>Quantity (Pieces):</label>
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityAndPrice(-5)">-5</button>
                                    <input type="number" id="input-card-qty" min="1" value="1" step="1" class="form-control text-center rounded-0" oninput="updateQuantityAndPrice()">
                                    <button class="btn btn-outline-secondary rounded-0" type="button" onclick="updateQuantityAndPrice(5)">+5</button>
                                </div>
                                <small class="text-muted mt-2 d-block">Minimum order: 1 piece. <span id="fixed-cost-display">**Bulk Price (100 pcs) used as base.**</span></small>
                            </div>

                            <div class="product-option-group" data-option-key="InnerCard">
                                <label>Include Extra Inner Card? (+10 PKR per Inner)</label>
                                <div class="d-flex gap-3">
                                    <label class="choice-card-inner selected" id="inner-yes" onclick="setInnerSelection(true)">
                                        <input type="radio" name="inner-option" value="true" checked>
                                        Yes (Required for this Card Style)
                                    </label>
                                    <label class="choice-card-inner" id="inner-no" onclick="setInnerSelection(false)">
                                        <input type="radio" name="inner-option" value="false">
                                        No
                                    </label>
                                </div>
                            </div>
                            
                        </div>

                        <div class="final-price-box" id="finalPriceBox">
                            <h4 class="mb-2">Total Price (PKR)</h4>
                            <h3 class="display-6 fw-bold" id="finalPriceDisplay">PKR 0</h3>
                            
                            <button class="btn btn-primary py-2 px-4 w-100 mt-3 rounded-0" onclick="submitOrder('wedding_card_order')">
                                <i class="fas fa-envelope me-2"></i> Place Order
                            </button>
                        </div>
                        
                        <div class="alert alert-info mt-3 rounded-0" id="selectionWarning" style="display: block;">
                            Please select a quantity of 1 or more.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="quote-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">Get a Custom Quote</h1>
        </div>
        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row g-4 justify-content-center">
                    <div class="col-lg-8">
                        <div class="bg-light p-4 rounded-0">
                            <form id="quote-form" onsubmit="handleQuoteSubmission(event)">
                                <h3 class="mb-4">Quick Inquiry for Wedding Cards</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 rounded-0" id="quote-name" placeholder="Your Name" required>
                                            <label for="quote-name">Your Name</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="tel" class="form-control border-0 rounded-0" id="quote-phone" placeholder="WhatsApp Phone" required>
                                            <label for="quote-phone">WhatsApp Phone</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control border-0 rounded-0" id="quote-product" value="Wedding Invitation Cards" readonly>
                                            <label for="quote-product">Product Name / Design ID</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="number" class="form-control border-0 rounded-0" id="quote-quantity" placeholder="Quantity (e.g., 500 cards)">
                                            <label for="quote-quantity">Required Quantity</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <textarea class="form-control border-0 rounded-0" placeholder="Details of your inquiry" id="quote-details" style="height: 150px" required></textarea>
                                            <label for="quote-details">Message</label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <button class="btn btn-primary w-100 py-3 rounded-0" type="submit">Submit Quote via WhatsApp</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    
    <section id="contact-section" class="section">
        <div class="container-fluid page-header py-5">
            <h1 class="text-center text-white display-6">Contact Us</h1>
        </div>
        <div class="container py-5 text-center">
             <h3>Contact us at +92 300 6238233</h3>
        </div>
    </section>

    <div class="container-fluid footer py-2">
        <div class="container text-center">
             <p class="text-white">Arham Printers 2025</p>
        </div>
    </div>

    <a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        // --- Configuration (UPDATED) ---
        const PUBLIC_DATA_URL = 'all_prices.json'; // Now fetching from the local JSON file
        const WHATSAPP_NUMBER = '923006238233';
        const API_URL = 'submit_order.php'; // Mock endpoint for email submission

        // --- DATA STORE ---
        let allProducts = {}; // Stores all flattened card metadata
        let currentCard = null;
        let hasInner = true; // Default selection for inner card
        
        const BULK_QTY = 100; // All prices in DB are for 100 pcs

        // --- FIXED INNER CARD COST ---
        const INNER_COST_PER_CARD = 10; 
        
        // --- PROFIT MARGINS (Retained as fixed business rules based on quantity) ---
        const PROFIT_TIERS = [
            { min: 1, max: 32, multiplier: 1.20 },
            { min: 33, max: 50, multiplier: 1.20 },
            { min: 51, max: 100, multiplier: 1.23 }, 
            { min: 101, max: 200, multiplier: 1.26 }, 
            { min: 201, max: 300, multiplier: 1.30 }, 
            { min: 301, max: 400, multiplier: 1.33 }, 
            { min: 401, max: 500, multiplier: 1.35 }, 
            { min: 501, max: Infinity, multiplier: 1.35 }, 
        ];


        // --- INITIALIZATION AND FETCHING (UPDATED) ---

        async function initialAppLoad() {
            let rawData;
            try {
                const response = await fetch(PUBLIC_DATA_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                rawData = await response.json(); 
            } catch (error) {
                console.error("Failed to load shop data:", error);
                showAlert("Failed to load wedding card data. Check console or network.", 'error');
                return;
            }
            
            initialCardSetup(rawData);
            loadWeddingCards();
            
            const spinner = document.getElementById('loading-spinner');
            if (spinner) spinner.style.display = 'none';
            
            showSection('shop-catalog'); 
        }

        function initialCardSetup(flatData) {
            // FIX: Correctly access the 'Special Occasions (Wedding)' key from the JSON file
            const weddingData = flatData['Special Occasions (Wedding)']; 
            allProducts = {};
            
            if (!weddingData) {
                document.getElementById('wedding-card-grid').innerHTML = '<p class="alert alert-danger">Error: Wedding card data structure missing from JSON response. Cannot load catalog.</p>';
                return;
            }
            
            Object.keys(weddingData).forEach(cardName => {
                const card = weddingData[cardName];
                // bulkPrice100 comes directly from the merged JSON data
                const price100 = card.bulkPrice100 || 0; 
                
                // Extract the image file name from the Cloudinary URL and ensure a local path is used
                let imagePath = card.imageFile || 'img/wedding/placeholder.webp'; 
                // Simple check to use a local path if the path ends with .webp or .png 
                if (imagePath.includes('cloudinary') && imagePath.includes('wedding/')) {
                    // Extract the part after the last '/'
                    const filename = imagePath.substring(imagePath.lastIndexOf('/') + 1);
                    // Standardize to local path
                    imagePath = `img/wedding/${filename}`;
                } else if (!imagePath.includes('img/')) {
                     // If it's just the filename, prepend the local folder
                     imagePath = `img/wedding/${imagePath.replace('.webp', '_1.webp').replace('.png', '_1.png')}`;
                }
                
                
                const FIXED_OVERHEAD = 500; // Re-introducing a standard overhead for consistency
                const EFFECTIVE_BULK_COST = price100 - FIXED_OVERHEAD;
                const ESTIMATED_UNIT_COST = EFFECTIVE_BULK_COST / BULK_QTY;

                allProducts[cardName] = { 
                    ...card, 
                    category: 'Wedding Cards', // Hardcoded category as flat data is only wedding
                    bulkPrice100: price100, 
                    estimatedUnitCost: ESTIMATED_UNIT_COST,
                    fixedCost: FIXED_OVERHEAD,
                    imageFile: imagePath // Use the modified local path
                };
            });
        }


        // --- PRICING CALCULATION LOGIC (USES DYNAMIC FETCHED PRICES) ---

        /**
         * Calculates the final price using the Cost-Plus formula with tiered profit margins
         * and includes the optional extra inner card cost.
         * @param {number} quantity - Number of cards.
         * @returns {number} The final calculated price.
         */
        function calculateFinalPrice(quantity) {
            if (quantity < 1 || !currentCard) return 0;
            
            const CARD_UNIT_COST = currentCard.estimatedUnitCost;
            const CARD_FIXED_COST = currentCard.fixedCost;

            let multiplier = 1.20; 
            
            for (const tier of PROFIT_TIERS) {
                if (quantity >= tier.min && quantity <= tier.max) {
                    multiplier = tier.multiplier;
                    break;
                }
            }
            
            const baseVariableCost = CARD_UNIT_COST * quantity;
            const innerCost = hasInner ? (INNER_COST_PER_CARD * quantity) : 0;
            const totalCostBeforeProfit = baseVariableCost + innerCost + CARD_FIXED_COST;
            const finalPrice = Math.round(totalCostBeforeProfit * multiplier);
            
            return finalPrice;
        }

        function getDisplayPrice(cardName) {
            const BENCHMARK_QTY = 200;
            const cardData = allProducts[cardName];
            if (!cardData) return { total: 0, perCard: '0.00', benchmarkQty: BENCHMARK_QTY };

            const originalCurrentCard = currentCard;
            currentCard = { ...cardData, quantity: BENCHMARK_QTY }; 
            
            const originalInnerState = hasInner;
            setInnerSelection(true, false); 

            const price = calculateFinalPrice(BENCHMARK_QTY);
            
            setInnerSelection(originalInnerState, false); 
            currentCard = originalCurrentCard; 

            const pricePerCard = price / BENCHMARK_QTY;
            
            return {
                total: parseInt(price).toLocaleString('en-PK'),
                perCard: pricePerCard.toFixed(2),
                benchmarkQty: BENCHMARK_QTY
            };
        }

        /**
         * Sets the state of the inner card selection and triggers a price update.
         */
        function setInnerSelection(selected, updatePrice = true) {
            hasInner = selected;

            document.getElementById('inner-yes').classList.toggle('selected', selected);
            document.getElementById('inner-no').classList.toggle('selected', !selected);
            
            if (updatePrice) {
                updateQuantityAndPrice(0);
            }
        }


        // --- DATA RENDERING FUNCTIONS (UPDATED IMAGE PATH LOGIC) ---

        function loadWeddingCards() {
            const categorizedCards = {};
            Object.values(allProducts).forEach(card => {
                if (!categorizedCards[card.category]) {
                    categorizedCards[card.category] = [];
                }
                categorizedCards[card.category].push(card);
            });
            
            let cardHTML = '';
            let cardGrid = document.getElementById('wedding-card-grid');

            if (Object.keys(categorizedCards).length === 0) {
                 cardGrid.innerHTML = '<p class="alert alert-warning">No card designs are currently available. Please contact us for a custom quote.</p>';
                 return;
            }

            Object.keys(categorizedCards).forEach(category => {
                cardHTML += `<h3 class="w-100 pt-5 border-top">${category}</h3>`;

                categorizedCards[category].forEach(card => {
                    const cardName = card.cardName;
                    
                    const originalCurrentCard = currentCard; 
                    currentCard = card;
                    const pricing = getDisplayPrice(cardName);
                    currentCard = originalCurrentCard; 

                    // FIX: Use the processed local image path
                    const imagePath = `${card.imageFile}`; 

                    cardHTML += `
                        <div class='col-lg-3 col-6 mb-4'>
                            <div class='card h-100 shadow-sm product-card-hover-container rounded-0'> 
                                <span class='card-price rounded-0'>PKR ${pricing.perCard} / pc (at ${pricing.benchmarkQty} pcs)</span>
                                <img src='${imagePath}' onerror="this.onerror=null;this.src='https://placehold.co/400x400/F28B00/FFF?text=Card+${cardName.replace(/[^\d]/g, '')}'" class='w-100' alt='${cardName}'>
                                <div class="product-footer-overlay p-0">
                                    <button class="btn btn-primary w-100 rounded-0 p-3" onclick="showCardDetails('${cardName}')">
                                        <i class="fas fa-search me-2"></i> View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                        `;
                });
            });

            cardGrid.innerHTML = cardHTML;
        }
        
        function updateQuantityAndPrice(change = 0) {
            const input = document.getElementById('input-card-qty');
            let quantity = parseInt(input.value) || 1; 
            const MIN_QTY = 1;
            
            if (change !== 0) {
                quantity = Math.max(MIN_QTY, quantity + change);
            } else {
                 quantity = Math.max(MIN_QTY, quantity);
            }
            
            input.value = quantity;
            
            if (currentCard && quantity >= MIN_QTY) {
                const totalPrice = calculateFinalPrice(quantity);
                
                document.getElementById('finalPriceDisplay').textContent = `PKR ${totalPrice.toLocaleString('en-PK', { minimumFractionDigits: 0 })}`;
                document.getElementById('finalPriceBox').style.display = 'block';
                document.getElementById('selectionWarning').style.display = 'none';

                // Update UI hint for fixed cost (now dynamic)
                document.getElementById('fixed-cost-display').textContent = `**Base Price (100 pcs: PKR ${currentCard.bulkPrice100.toFixed(0)}) used for calculation. Fixed overhead of ${currentCard.fixedCost} PKR applied.**`;


                // Update the hidden product field for the quote form
                currentCard.totalPrice = totalPrice;
                currentCard.quantity = quantity;
                currentCard.hasInner = hasInner; 
                document.getElementById('quote-product').value = `${currentCard.cardName} (${quantity} pcs)`;

            } else {
                 document.getElementById('finalPriceBox').style.display = 'none';
                 document.getElementById('selectionWarning').style.display = 'block';
            }
        }

        function showCardDetails(cardName) {
            const cardData = allProducts[cardName];
            if (!cardData) return;

            currentCard = {
                cardName: cardName,
                imageFile: cardData.imageFile,
                description: cardData.description,
                bulkPrice100: cardData.bulkPrice100, 
                estimatedUnitCost: cardData.estimatedUnitCost,
                fixedCost: cardData.fixedCost
            };
            
            setInnerSelection(true, false); 

            document.getElementById('detail-product-name-header').textContent = cardName;
            document.getElementById('detail-product-name-body').textContent = cardName;
            // FIX: Use the stored local image path
            document.getElementById('detail-product-image').src = currentCard.imageFile; 
            document.getElementById('detail-product-image').onerror = function() {
                this.src = `https://placehold.co/600x400/F28B00/FFF?text=${encodeURIComponent(cardName)}`;
            };
            document.getElementById('card-description').textContent = currentCard.description; 
            document.getElementById('input-card-qty').value = 100; 

            // Update UI hint for fixed cost
            document.getElementById('fixed-cost-display').textContent = `**Base Price (100 pcs: PKR ${currentCard.bulkPrice100.toFixed(0)}) used for calculation. Fixed overhead of ${currentCard.fixedCost} PKR applied.**`;


            showSection('product-detail');
            updateQuantityAndPrice(0);
        }

        // --- ORDER SUBMISSION AND ALERT FUNCTIONS ---
        
        async function submitOrder(type) {
            if (!currentCard || currentCard.totalPrice === 0) {
                 showAlert('Please select a valid quantity before placing an order.', 'error');
                 return;
            }

            const total = document.getElementById('finalPriceDisplay').textContent;
            const innerStatus = currentCard.hasInner ? `Yes (+${INNER_COST_PER_CARD} PKR/pc)` : 'No (Standard Card)';
            
            const formData = {
                order_type: type,
                product_name: currentCard.cardName,
                quantity: currentCard.quantity,
                total_price: total,
                inner_card_status: innerStatus,
            };

            showAlert('Sending order details to server...', 'info');

            // NOTE: Mock API call is kept as is since the objective is client-side refactoring
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    showAlert('Order details successfully submitted! We will contact you via email shortly.', 'success');
                } else {
                    showAlert('Server error during submission. Please try the WhatsApp quote option instead.', 'error');
                }
            } catch (error) {
                console.error('Submission failed:', error);
                showAlert('Network error. Please try the WhatsApp quote option instead.', 'error');
            }
        }


        function handleQuoteSubmission(e) {
            e.preventDefault();
            const name = document.getElementById('quote-name').value;
            const phone = document.getElementById('quote-phone').value;
            const productID = document.getElementById('quote-product').value;
            const quantity = document.getElementById('quote-quantity').value;
            const details = document.getElementById('quote-details').value;
            
            let whatsappMessage = `*NEW WEDDING CARD QUOTE REQUEST (WEB)*\n`;
            whatsappMessage += `*Customer:* ${name}\n`;
            whatsappMessage += `*Phone:* ${phone}\n`;
            whatsappMessage += `*Product/ID:* ${productID}\n`;
            whatsappMessage += `*Required Quantity:* ${quantity}\n`;
            whatsappMessage += `*Details:* ${details}`;
            
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');
            showAlert('Quote submitted via WhatsApp! We will contact you shortly.', 'success');
            document.getElementById('quote-form').reset();
        }

        function showSection(sectionName, productName = "", price = 0) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            const target = document.getElementById(sectionName + '-section');
            if(target) target.classList.add('active');
            else document.getElementById('shop-catalog-section').classList.add('active');

            if (sectionName === 'quote' && productName) {
                document.getElementById('quote-product').value = productName;
                document.getElementById('quote-quantity').value = 500;
                document.getElementById('quote-details').value = `I am interested in ${productName}. I require approximately 500 pieces.`;
            }
            
            if (typeof setActiveMobileNav === 'function') {
                setActiveMobileNav(sectionName);
            }
            
            window.scrollTo(0, 0);
        }
        
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.style.minWidth = '300px';
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 5000);
        }
        
        document.addEventListener('DOMContentLoaded', initialAppLoad);
    </script>
</div>
</body>
</html>